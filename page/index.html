<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <meta name="description" content="Documentation for BROWNPAK">
   
    <meta name="author" content="Sarit Dutta" >
    <link rel="icon" href="../favicon.png">

    <title>User Guide &ndash; BROWNPAK</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">BROWNPAK <small>0.2</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>User Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  <div class="row">
    <h1>User Guide</h1>
    <div class="row">
    <div class="col-lg-12">
    <div class="well well-sm" style="min-height: 40px;">
      <ul class="list-inline" style="margin-bottom:0px; display:inline">
         
        <li><i class="fa fa-pencil"></i> Sarit Dutta</li>
         
         
<!--
        
-->
      </ul>
        <ol class="breadcrumb in-well">
      
         <li class="active">User Guide</li>
      </ol>
    </div>
    </div>
    </div>
  </div>
  
  <div class="row">
    <div class="col-md-9 col-md-push-3" id='text'>
      <p>This is BROWNPAK. It can perform the following kinds of simulations:</p>
<ul>
<li>Energy minimization (also called structure relaxation) via steepest
  descent.</li>
<li>Brownian dynamics (BD)</li>
<li>Multiparticle collision dynamics (MPCD)</li>
</ul>
<p>The source code is written in F2008 compliant fortran. There is a dependency on
the Intel Math Kernel Library (MKL). I have compiled the code with gfortran-8.3
compiler and MKL 2019 Update 4.</p>
<h2>Directory structure</h2>
<p>The directory structure is as follows:</p>
<ul>
<li><em>src</em> contains the Fortran source files. There are some unused source files in
 <em>src/extra</em>.</li>
<li><em>bin</em> contains the compiled executable, named <em>brownpak</em>. The executable can
  be run directly from here, or from some other location with appropriately
  specified path to the executable. It is best not to move around the
executable, rather invoke the executable from the directory where you want to
run it.</li>
<li><em>build</em> is the build directory. It contains a makefile. It is necessary to
  update the paths in the makefile to suit the local system.</li>
<li><em>utils</em> contains several utilities. There are python scripts the generate
  initial configuration, fortran routines to extract configurations, etc.</li>
<li><em>tests</em> contains testing routines for development purposes.</li>
<li><em>docs</em> contain the autogenerated fortran documentation (using FORD). To read
  the documentation, start at the file <em>docs/html/index.html</em>.</li>
</ul>
<h2>Input and output files</h2>
<p>BROWNPAK reads several input files and produces several output files. The input
files are:</p>
<ul>
<li><code>fn_control</code>: This file contains various directives on what simulation to run,
  time steps, etc. The directives are provided as a list of key-value pairs. The default name
 for this file is <em>control.txt</em>. </li>
<li><code>fn_config</code>: This file specifies the configuration of the system of be
  simulated, i.e. atom positions, interactions, etc. The extension for this file
  is <em>.cfg</em>, though not mandatory. </li>
</ul>
<p>The output files are:</p>
<ul>
<li><code>fn_traj</code>: This is a binary file containing the trajectory data. These have
  extension of <em>.bin</em>, though not mandatory.</li>
<li><code>fn_stats</code>: This is a text file containing a minimal set of statistics.
  Further statistics may be obtained by post processing <code>fn_traj</code>. During
  equilibration, the statistics will be written to a file called <code>fn_stats.eq</code>.</li>
<li><em>brownpak.log</em>: Log file. Check this for progress and error messsages</li>
<li>For energy-minimization, two other files with <code>-rlx</code> in their names will be
  produced. The file <code>fn_config-rlx.cfg</code> contains the minimized configuration,
and the file <code>fn_config-rlx.txt</code> contains the same configuration in LAMMPS data
format for visualization in Ovito.</li>
</ul>
<h2>Compilation and running</h2>
<p>There is a makefile in <em>build</em>. In the makefile, the <code>DEBUG</code> flag should be set
to <code>false</code> for production builds. For testing purposes, set <code>DEBUG = true</code>.</p>
<p>The compiler name is specified via the variable <code>FC</code>. e.g. for intel it will be
appropriate to use <code>FC = ifort</code>. I use fortran95 wrappers to MKL as well. If one
is using a non-Intel compiler, these wrappers need to be built (see the MKL
documentation on how to do this). Anyways, since I am using gfortran, I specify the location of the
wrappers through the variable <code>MKL_INTRFC</code>. Furthermore, <code>MKLROOT</code> is the root
directory of the MKL installation. For an Intel compiler, <code>MKL_INTRFC</code> is not
necessary, but <code>MKLROOT</code> must be specified. It may be helpful to use the <a href="https://software.intel.com/en-us/articles/intel-mkl-link-line-advisor">Intel
Link Line Advisor</a>
for looking up appropriate flags. Appropriate compilation flags must be
specified via <code>FCFLAGS</code>. The current flags pertain to gfortran. For debug
builds, the flags should turn off optimization, raise all warnings, check
bounds, etc.; for production builds do turn on necessary optimization (without
being too aggressive), loop unrolling, interprocedural optimizations, inlining,
etc.</p>
<div class="codehilite"><pre><span></span>make
</pre></div>


<p>To clean all <code>.o</code> and <code>.mod</code> files, do</p>
<div class="codehilite"><pre><span></span>make clean
</pre></div>


<p>To remove all <code>.o</code>, <code>.mod</code>, and the executable, do</p>
<div class="codehilite"><pre><span></span>make clobber
</pre></div>


<p>To run, the simplest way is to go to <em>bin</em> and</p>
<div class="codehilite"><pre><span></span>./brownpak <span class="nv">fn_control</span><span class="o">=</span>controlfile.txt  <span class="nv">job_tag</span><span class="o">=</span>some_number
</pre></div>


<p>Both the arguments <code>fn_control</code> and <code>job_tag</code> are optional.
If you do not specify the name of the control file, it will be assumed to be
<code>control.txt</code>. The <code>job_tag</code> argument is there to help running array jobs on a
cluster. For example, with SGE job scheduler I can request array jobs numbered
from 1-16 and specify <code>job_tag=$SGE_TASK_ID</code>. Then all output files will have
the numbers 1-16 appended to their file names, like traj.bin.1, traj.bin.2, etc.</p>
<p>Instead to running the executable from <em>bin</em>, you can run it from some other
directory as</p>
<div class="codehilite"><pre><span></span>path_to_bin/brownpak <span class="nv">fn_control</span><span class="o">=</span>controlfile.txt  <span class="nv">job_tag</span><span class="o">=</span>some_number
</pre></div>


<p>The above is more convenient with running multiple jobs on a cluster.</p>
<p>Note that once compiled, if you change the source files a recompilation is
necessary. Unlike some codes that you may be familiar with, changing input files
do not require recompilation.</p>
<h2>Structure of the control file</h2>
<p>Here is a sample control file. It is called `control.txt.</p>
<div class="codehilite"><pre><span></span><span class="n">sim_style</span>           <span class="mi">2</span>            
<span class="n">use_verlet_tab</span>      <span class="n">F</span>
<span class="n">rcutoff</span>             <span class="mi">5</span><span class="p">.</span><span class="mi">25</span><span class="n">D0</span>
<span class="n">tskin</span>               <span class="mi">2</span><span class="p">.</span><span class="mi">1</span><span class="n">D0</span>
<span class="n">use_cell_list</span>       <span class="n">T</span>
<span class="n">excluded_atoms</span>      <span class="mi">1</span>
<span class="n">lvdw</span>                <span class="n">T</span>
<span class="n">lhdia</span>               <span class="n">F</span>
<span class="n">mob_fctr</span>            <span class="n">KRYL</span>
<span class="n">lelectrostatics</span>     <span class="n">F</span>

<span class="n">tim_stp</span>             <span class="mi">1</span><span class="p">.</span><span class="mi">0</span><span class="n">D</span><span class="o">-</span><span class="mi">2</span>
<span class="n">nts_md</span>              <span class="mi">100</span>
<span class="n">nts_eql</span>             <span class="mi">0</span><span class="p">.</span><span class="mi">0</span><span class="n">D0</span>
<span class="n">nts_eql_samp</span>        <span class="mi">10</span>
<span class="n">nts_sim</span>             <span class="mi">2</span><span class="p">.</span><span class="mi">0</span><span class="n">D3</span>
<span class="n">nts_samp</span>            <span class="mi">10</span>
<span class="n">nts_dump</span>            <span class="mi">10</span>
<span class="n">nts_log</span>             <span class="mi">10</span>

<span class="n">fn_cfg</span>              <span class="n">sample</span><span class="p">.</span><span class="n">cfg</span>
<span class="n">fn_revive</span>           <span class="n">revive</span><span class="p">.</span><span class="n">bin</span>
<span class="n">fn_stats</span>            <span class="n">stats</span><span class="p">.</span><span class="n">txt</span>
<span class="n">fn_traj</span>             <span class="n">traj</span><span class="p">.</span><span class="n">bin</span>

<span class="n">lrevive</span>             <span class="n">F</span>
<span class="n">read_seed</span>           <span class="n">F</span>
<span class="n">write_seed</span>          <span class="n">T</span>
<span class="n">write_eql_stats</span>     <span class="n">T</span>
<span class="n">write_traj</span>          <span class="n">T</span>
<span class="n">traj_frmcmp</span>         <span class="mi">1</span> <span class="mi">0</span> <span class="mi">0</span> <span class="mi">1</span>
<span class="n">traj_wmpcd</span>          <span class="n">F</span>
</pre></div>


<p>As you can see, it lists a number of keywords and their corresponding values
separated by whitespace. The maximum length of a line is as specified in
<a href="../module/m_globals.html#variable-mxrdln">mxrdln</a>.</p>
<p></p><div class="alert alert-info" role="alert"><h4>Note</h4><p>Each of the keywords in the control file is a variable listed in
<a href="../module/m_globals.html">m_globals</a>. Please look up the detailed description and possible set
of allowed values there.</p></div>
<p></p><div class="alert alert-warning" role="alert"><h4>Warning</h4><p>There are no checks performed on the consistency of the values provided
in the control file. If you use unphysical values, your results may be incorrect
or the program may crash.</p></div>
<p>There can be blank lines between the keywords. Comments begin with <code>#</code>. If the
<code>#</code> character is found on any line the rest of the line after <code>#</code> will be
discarded. The keywords and the values must be separated by one or more whitespaces.</p>
<p>I will elaborate on some specific aspects of the value format:</p>
<ul>
<li>Strings need not be quoted</li>
<li>Booleans may be simply given as T or F instead of .true. or .false.</li>
<li>Floats are always double precision, so please use <code>*.D*</code> fortran format. For
  example, a value of <code>2.1</code> is single precision; instead specify it at <code>2.1D0</code>.
  Other exponents are similar, e.g., <code>1.0D-2</code> for <code>0.01</code>.</li>
<li>Values requiring uppercase letters must be given in that form, e.g. <code>KRYL</code> is
  not the same a <code>kryl</code>.</li>
<li>All the keywords starting with <code>nts</code> except <code>nts_md</code> are long ints. For
  convenience these values may be given in <code>*.D*</code> format. Internally they will
  be cast as long ints. <code>mts_md</code> is not a long int because it does not make
  sense for it to be a large number, else the simulation will never complete.</li>
<li><code>traj_frmcmp</code>: See <a href="../module/m_globals.html#variable-traj_frmcmp">traj_frmcmp</a> for details. Each element of the
  sequence can be either 0 or 1 (separated by whitespaces), e.g. 1 1 1 1 or 1 0 0 1.
  All four being zero is allowed, but makes no sense.</li>
<li>Choosing <code>nts_dump &lt;= nts_samp</code> is a good idea, but do not dump too frequently
  either.</li>
</ul>
<h2>Structure of the trajectory file</h2>
<p>The trajectory file is a binary file, i.e. it is a stream of bytes. The byte
order is native. It can be read back in python (using <em>struct</em> to unpack), in
fortran (opening the file with <code>form='unformatted, access='stream'</code>), or in any
other language.</p>
<p></p><div class="alert alert-warning" role="alert"><h4>Warning</h4><p>If <code>traj_wmpcd = T</code> in the control file, the trajectory file can be
extremely large. Explicit data for the position and velocities of MPCD atoms are
rarely needed. MPCD atoms do not have forces or charge on them.</p></div>
<p>I will call the trajectory file as <code>traj.bin</code>. It contains a header, followed by
a sequence of frames. The structure of the header is:</p>
<ul>
<li><em>header_size</em>: 1 int (32 bits)</li>
<li><em>frame_size</em>: 1 int (32 bits)</li>
<li><em>num_atoms</em>: 1 int (32 bits). Number of non-MPCD atoms in the trajectory.</li>
<li><em>num_mpcd_atoms</em>: 1 int (32 bits). Number of MPCD atoms in the trajectory.</li>
<li><em>frmcmp</em>: 4 ints (32 bits each). Components of each frame, as specified by
  <code>traj_frmcmp</code> in the control file.</li>
</ul>
<p>During creation of a trajectory, <em>num_atoms</em> and <em>num_mpcd_atoms</em> are given
to <a href="../module/m_trajectory.html#proc-traj_create">traj_create</a>. Depending on <a href="../module/m_globals.html#variable-traj_wmpcd">traj_wmpcd</a>, it is
possible for an MPCD simulation to not write any MPCD data to <code>traj.bin</code>. This
should be the commonly used case. For BD/energy-minimization the value of
<a href="../module/m_globals.html#variable-traj_wmpcd">traj_wmpcd</a> does not matter.</p>
<p>Following the header, there is a sequence of frame data, written according to
<a href="../module/m_globals.html#variable-traj_wmpcd">traj_wmpcd</a> and <a href="../module/m_globals.html#variable-traj_frmcmp">traj_frmcmp</a>.</p>
<h2>Structure of the revive file</h2>
<p>The revive file is a binary dump. It contains enough information to restart the
simulation if <code>lrevive = T</code> in the control file. To see what gets dumped, please
examine the source for <a href="../module/m_config_io.html#proc-write_dump">write_dump</a>.</p>
<h2>Interactions</h2>
<p>The following kinds of interactions are available (or can be made available with
minimal effort):</p>
<ul>
<li>
<p><em>Bonds</em></p>
<p>All bonds have a <em>type</em> called <em>bond_type</em>.  <em>bond_type</em>s are assigned
by the user. For example, in a A-B diblock polymer, the user may choose A-A bonds
as type 1, B-B bonds as type 2, and the A-B bond as type 3.</p>
<p>Each <em>bond_type</em> is completely determined by a <em>style</em>, called <em>bond_style</em>,
and a set of parameters, called <em>bond_params</em>. <em>bond_style</em>s are chosen from the
list of available styles, as specified in <a href="../module/m_ia_bond.html">m_ia_bond</a>. The number of required
parameters depend on the chosen style. The maximum number of parameters is
<a href="../module/m_globals.html#variable-mxparam">mxparam</a>.  For example, in our A-B diblock, the A-A bonds can be
of type 1, with style 3 (corresponding to Kremer-Grest bond), and a set of four
parameters; the B-B bonds can be of type 2, and also of style 3, with a set
of four parameters, same as or different from the parameters of A-A bonds.</p>
</li>
<li>
<p><em>Angles</em></p>
<p>Similar to bonds, angles have types and styles as well. See <a href="../module/m_ia_angle.html">m_ia_angle</a>.
Only one non-trivial style is available, as this is the most commonly used
style for polymers. However, more styles can be added if necessary.</p>
</li>
<li>
<p><em>Dihedrals</em></p>
<p>Dihedrals are not typically used in the kind of polymer models I deal with.
So, only the trivial style is present. In case you need a dihedral, add the
appropriate routines to <a href="../module/m_ia_dihedral.html">m_ia_dihedral</a>.</p>
</li>
<li>
<p><em>Tethers</em></p>
<p>Tethers are pointwise restraints on one or more atoms. There can be multiple
tethers, see <a href="../module/m_ia_tether.html">m_ia_tether</a>.</p>
</li>
<li>
<p><em>Pairwise</em>: See <a href="../module/m_ia_vdw.html">m_ia_vdw</a> for a list. </p>
</li>
<li>
<p><em>External</em>: See <a href="../module/m_ia_external.html">m_ia_external</a> for a list. </p>
</li>
</ul>
<h2>Structure of the config file</h2>
<div class="codehilite"><pre><span></span><span class="n">Sample</span>
<span class="n">SIMBOX</span>
<span class="mi">20</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">0</span>  <span class="mi">20</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>
<span class="mi">0</span><span class="p">.</span><span class="mi">0</span>  <span class="mi">0</span><span class="p">.</span><span class="mi">0</span>  <span class="mi">20</span>

<span class="n">IMCON</span>  <span class="mi">1</span>

<span class="n">ATOM_TYPES</span>  <span class="mi">0</span>

<span class="n">MPCD_ATOMS</span>  <span class="mi">40000</span>  <span class="mi">5</span>

<span class="n">ATOMS</span>  <span class="mi">0</span>

<span class="n">MOLECULE_TYPES</span>  <span class="mi">0</span>

<span class="n">MOLECULES</span>  <span class="mi">0</span>
</pre></div>


<h2>Reading the trajectory file for postprcessing (in fortran)</h2>
<h2>Restarting a simulation</h2>
<h2>Workflow: Energy minimization</h2>
<h2>Workflow: BD</h2>
<h2>Workflow: MPCD</h2>
    </div>
    
  </div>

    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://www.freebsd.org/copyright/freebsd-doc-license.html">FreeBSD Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> BROWNPAK was developed by Sarit Dutta</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>