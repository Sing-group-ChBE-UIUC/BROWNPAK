<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
    <meta name="description" content="Documentation for BROWNPAK">
   
    <meta name="author" content="Sarit Dutta" >
    <link rel="icon" href="../favicon.png">

    <title>m_interaction.f90 &ndash; BROWNPAK</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">BROWNPAK <small>0.2</small></a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li><a href='../page/index.html'>User Guide</a></li>
      
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
            <li><a href="../lists/types.html">Derived Types</a></li>
        
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             
<li class="visible-xs hidden-sm visible-lg"><a href="../lists/types.html">Derived Types</a></li>


<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>m_interaction.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title=" 6.8% of total for source files.">416 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/m_interaction.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">m_interaction.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-0">Modules</a></h3></div>
  <div id="mods-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/m_interaction.html">m_interaction</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/m_interaction.f90.html#src">m_interaction.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~m_interaction.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilem_interactionf90EfferentGraph" width="641pt" height="568pt"
 viewBox="0.00 0.00 641.00 568.29" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~m_interaction.f90~~EfferentGraph" class="graph" transform="scale(.8524 .8524) rotate(0) translate(4 662.6969)">
<title>sourcefile~~m_interaction.f90~~EfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-662.6969 748,-662.6969 748,4 -4,4"/>
<!-- sourcefile~m_interaction.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~m_interaction.f90</title>
<polygon fill="none" stroke="#000000" points="744,-347.2671 651,-347.2671 651,-323.2671 744,-323.2671 744,-347.2671"/>
<text text-anchor="middle" x="697.5" y="-332.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">m_interaction.f90</text>
</g>
<!-- sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~m_globals.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/m_globals.f90.html" xlink:title="m_globals.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="480,-367.2671 402,-367.2671 402,-343.2671 480,-343.2671 480,-367.2671"/>
<text text-anchor="middle" x="441" y="-352.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_globals.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M679.7939,-347.4072C663.7101,-357.649 638.912,-371.5307 615,-377.2671 572.214,-387.5313 559.553,-383.5231 516,-377.2671 505.516,-375.7612 494.4528,-373.1283 484.1383,-370.1958"/>
<polygon fill="#ff0000" stroke="#ff0000" points="485.1054,-366.8319 474.5218,-367.3193 483.0994,-373.5383 485.1054,-366.8319"/>
</g>
<!-- sourcefile~m_cell_list.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~m_cell_list.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/m_cell_list.f90.html" xlink:title="m_cell_list.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="605,-368.2671 526,-368.2671 526,-344.2671 605,-344.2671 605,-368.2671"/>
<text text-anchor="middle" x="565.5" y="-353.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_cell_list.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_cell_list.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_cell_list.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M650.9617,-342.6709C639.3651,-344.5158 626.8882,-346.5008 615.1479,-348.3686"/>
<polygon fill="#ff0000" stroke="#ff0000" points="614.3869,-344.9455 605.061,-349.9733 615.4868,-351.8586 614.3869,-344.9455"/>
</g>
<!-- sourcefile~m_ia_vdw.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~m_ia_vdw.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/m_ia_vdw.f90.html" xlink:title="m_ia_vdw.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="604,-548.2671 527,-548.2671 527,-524.2671 604,-524.2671 604,-548.2671"/>
<text text-anchor="middle" x="565.5" y="-533.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ia_vdw.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_vdw.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_vdw.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M695.0996,-347.5361C688.2576,-379.4342 665.7827,-465.9131 615,-515.2671 613.7573,-516.4748 612.4346,-517.6178 611.05,-518.699"/>
<polygon fill="#ff0000" stroke="#ff0000" points="609.0277,-515.8395 602.5694,-524.2384 612.8557,-521.7001 609.0277,-515.8395"/>
</g>
<!-- sourcefile~m_ia_angle.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~m_ia_angle.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/m_ia_angle.f90.html" xlink:title="m_ia_angle.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="607.5,-506.2671 523.5,-506.2671 523.5,-482.2671 607.5,-482.2671 607.5,-506.2671"/>
<text text-anchor="middle" x="565.5" y="-491.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ia_angle.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_angle.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_angle.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M693.2808,-347.3186C683.5036,-373.6316 656.885,-436.7821 615,-473.2671 613.4954,-474.5777 611.897,-475.8159 610.2308,-476.9845"/>
<polygon fill="#ff0000" stroke="#ff0000" points="608.2221,-474.1084 601.4574,-482.2625 611.8306,-480.1067 608.2221,-474.1084"/>
</g>
<!-- sourcefile~m_ia_external.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node6" class="node">
<title>sourcefile~m_ia_external.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node6"><a xlink:href=".././sourcefile/m_ia_external.f90.html" xlink:title="m_ia_external.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="613.5,-464.2671 517.5,-464.2671 517.5,-440.2671 613.5,-440.2671 613.5,-464.2671"/>
<text text-anchor="middle" x="565.5" y="-449.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ia_external.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_external.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_external.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M684.4793,-347.3571C668.3248,-362.2979 639.8693,-388.4235 615,-410.2671 606.1445,-418.0452 596.2636,-426.4773 587.6728,-433.7312"/>
<polygon fill="#ff0000" stroke="#ff0000" points="585.3057,-431.1488 579.9072,-440.2651 589.8124,-436.5051 585.3057,-431.1488"/>
</g>
<!-- sourcefile~m_connectivity.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node7" class="node">
<title>sourcefile~m_connectivity.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node7"><a xlink:href=".././sourcefile/m_connectivity.f90.html" xlink:title="m_connectivity.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="615,-63.2671 516,-63.2671 516,-39.2671 615,-39.2671 615,-63.2671"/>
<text text-anchor="middle" x="565.5" y="-48.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_connectivity.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_connectivity.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_connectivity.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M696.129,-323.2293C691.2825,-285.1566 672.0634,-165.273 615,-87.2671 610.0152,-80.4529 603.3565,-74.4008 596.5431,-69.294"/>
<polygon fill="#ff0000" stroke="#ff0000" points="598.1594,-66.1562 587.9444,-63.3448 594.1766,-71.9128 598.1594,-66.1562"/>
</g>
<!-- sourcefile~m_verlet.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node8" class="node">
<title>sourcefile~m_verlet.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node8"><a xlink:href=".././sourcefile/m_verlet.f90.html" xlink:title="m_verlet.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="600.5,-120.2671 530.5,-120.2671 530.5,-96.2671 600.5,-96.2671 600.5,-120.2671"/>
<text text-anchor="middle" x="565.5" y="-105.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_verlet.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_verlet.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_verlet.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M695.3242,-323.0462C688.7971,-289.4829 666.5579,-194.5195 615,-136.2671 611.5308,-132.3474 607.3756,-128.8504 602.9672,-125.769"/>
<polygon fill="#ff0000" stroke="#ff0000" points="604.6281,-122.6799 594.2917,-120.354 600.9216,-128.6181 604.6281,-122.6799"/>
</g>
<!-- sourcefile~m_ia_bond.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node9" class="node">
<title>sourcefile~m_ia_bond.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node9"><a xlink:href=".././sourcefile/m_ia_bond.f90.html" xlink:title="m_ia_bond.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="606.5,-326.2671 524.5,-326.2671 524.5,-302.2671 606.5,-302.2671 606.5,-326.2671"/>
<text text-anchor="middle" x="565.5" y="-311.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ia_bond.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_bond.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_bond.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M650.9617,-327.8633C639.9369,-326.1093 628.1164,-324.2288 616.8897,-322.4427"/>
<polygon fill="#ff0000" stroke="#ff0000" points="617.2119,-318.9501 606.7862,-320.8354 616.1121,-325.8631 617.2119,-318.9501"/>
</g>
<!-- sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node10" class="node">
<title>sourcefile~m_constants_math.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node10"><a xlink:href=".././sourcefile/m_constants_math.f90.html" xlink:title="m_constants_math.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="242,-304.2671 123,-304.2671 123,-280.2671 242,-280.2671 242,-304.2671"/>
<text text-anchor="middle" x="182.5" y="-289.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_constants_math.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M689.1798,-323.0984C675.8121,-304.5412 647.7092,-269.4149 615,-251.2671 561.2544,-221.4478 541.0966,-227.9738 480,-221.2671 390.7047,-211.465 363.1747,-199.719 278,-228.2671 249.4455,-237.8378 221.3741,-258.3606 203.1366,-273.5998"/>
<polygon fill="#ff0000" stroke="#ff0000" points="200.7898,-271.0016 195.4827,-280.1715 205.3498,-276.3126 200.7898,-271.0016"/>
</g>
<!-- sourcefile~m_ia_tether.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node11" class="node">
<title>sourcefile~m_ia_tether.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node11"><a xlink:href=".././sourcefile/m_ia_tether.f90.html" xlink:title="m_ia_tether.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="608,-169.2671 523,-169.2671 523,-145.2671 608,-145.2671 608,-169.2671"/>
<text text-anchor="middle" x="565.5" y="-154.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ia_tether.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_tether.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_tether.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M693.6616,-323.1027C684.32,-295.182 657.9642,-225.6499 615,-183.2671 611.7639,-180.0748 608.0554,-177.1804 604.1557,-174.5818"/>
<polygon fill="#ff0000" stroke="#ff0000" points="605.8018,-171.4882 595.422,-169.3644 602.2119,-177.4976 605.8018,-171.4882"/>
</g>
<!-- sourcefile~m_ia_dihedral.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node12" class="node">
<title>sourcefile~m_ia_dihedral.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node12"><a xlink:href=".././sourcefile/m_ia_dihedral.f90.html" xlink:title="m_ia_dihedral.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="613.5,-284.2671 517.5,-284.2671 517.5,-260.2671 613.5,-260.2671 613.5,-284.2671"/>
<text text-anchor="middle" x="565.5" y="-269.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ia_dihedral.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_dihedral.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge11" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_ia_dihedral.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M674.948,-323.25C658.4821,-314.6078 635.5411,-302.8388 615,-293.2671 611.5836,-291.6752 608.0136,-290.063 604.4234,-288.4766"/>
<polygon fill="#ff0000" stroke="#ff0000" points="605.5311,-285.1419 594.9645,-284.3691 602.7429,-291.5627 605.5311,-285.1419"/>
</g>
<!-- sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node13" class="node">
<title>sourcefile~m_precision.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node13"><a xlink:href=".././sourcefile/m_precision.f90.html" xlink:title="m_precision.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="87,-304.2671 0,-304.2671 0,-280.2671 87,-280.2671 87,-304.2671"/>
<text text-anchor="middle" x="43.5" y="-289.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_precision.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge12" class="edge">
<title>sourcefile~m_interaction.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M696.8339,-347.306C694.0927,-384.637 680.4647,-499.4008 615,-557.2671 470.6758,-684.8398 345.3001,-688.2252 182.5,-585.2671"/>
</g>
<!-- sourcefile~m_globals.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge14" class="edge">
<title>sourcefile~m_globals.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M428.9818,-367.3058C415.1201,-380.3619 391.0095,-400.6255 366,-410.2671 289.4967,-439.7606 258.3635,-460.3693 182.5,-429.2671"/>
</g>
<!-- sourcefile~m_trajectory.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node15" class="node">
<title>sourcefile~m_trajectory.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node15"><a xlink:href=".././sourcefile/m_trajectory.f90.html" xlink:title="m_trajectory.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="366,-481.2671 278,-481.2671 278,-457.2671 366,-457.2671 366,-481.2671"/>
<text text-anchor="middle" x="322" y="-466.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_trajectory.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_globals.f90&#45;&gt;sourcefile~m_trajectory.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge13" class="edge">
<title>sourcefile~m_globals.f90&#45;&gt;sourcefile~m_trajectory.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M432.6194,-367.4784C419.7837,-385.5723 393.8046,-419.8787 366,-443.2671 362.467,-446.2389 358.5526,-449.0768 354.5577,-451.7123"/>
<polygon fill="#ff0000" stroke="#ff0000" points="352.4616,-448.8934 345.8005,-457.1324 356.1456,-454.8456 352.4616,-448.8934"/>
</g>
<!-- sourcefile~m_simbox.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node16" class="node">
<title>sourcefile~m_simbox.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node16"><a xlink:href=".././sourcefile/m_simbox.f90.html" xlink:title="m_simbox.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="361,-401.2671 283,-401.2671 283,-377.2671 361,-377.2671 361,-401.2671"/>
<text text-anchor="middle" x="322" y="-386.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_simbox.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_globals.f90&#45;&gt;sourcefile~m_simbox.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge15" class="edge">
<title>sourcefile~m_globals.f90&#45;&gt;sourcefile~m_simbox.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M401.7052,-366.4942C391.8549,-369.3086 381.1663,-372.3624 370.9113,-375.2924"/>
<polygon fill="#ff0000" stroke="#ff0000" points="369.9073,-371.9392 361.2536,-378.0518 371.8304,-378.6698 369.9073,-371.9392"/>
</g>
<!-- sourcefile~m_cell_list.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge16" class="edge">
<title>sourcefile~m_cell_list.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M525.7651,-355.9479C514.5368,-355.8578 502.1791,-355.7585 490.4542,-355.6643"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="490.3857,-352.1638 480.3579,-355.5832 490.3294,-359.1635 490.3857,-352.1638"/>
</g>
<!-- sourcefile~m_cell_list.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge18" class="edge">
<title>sourcefile~m_cell_list.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M182.5,-585.2671C152.0641,-566.0188 142.5399,-560.5166 123,-530.2671 76.9121,-458.9192 54.9117,-358.1942 47.042,-314.2281"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="50.4834,-313.588 45.3396,-304.3256 43.5846,-314.7741 50.4834,-313.588"/>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M441,-471.2671C386.8874,-503.0475 382.1788,-529.4713 322,-547.2671"/>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M555.4881,-368.5079C535.8644,-391.749 489.9686,-442.5077 441,-471.2671"/>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M322,-547.2671C260.3787,-565.4894 236.8097,-619.6137 182.5,-585.2671"/>
</g>
<!-- sourcefile~m_vector.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node17" class="node">
<title>sourcefile~m_vector.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node17"><a xlink:href=".././sourcefile/m_vector.f90.html" xlink:title="m_vector.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="358.5,-55.2671 285.5,-55.2671 285.5,-31.2671 358.5,-31.2671 358.5,-55.2671"/>
<text text-anchor="middle" x="322" y="-40.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_vector.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_cell_list.f90&#45;&gt;sourcefile~m_vector.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge17" class="edge">
<title>sourcefile~m_cell_list.f90&#45;&gt;sourcefile~m_vector.f90</title>
<path fill="none" stroke="#ff7f00" stroke-dasharray="5,2" d="M527.0258,-344.0671C522.9408,-341.627 519.1394,-338.7211 516,-335.2671 480.2625,-295.9486 506.212,-267.4844 480,-221.2671 442.6338,-155.3824 377.7712,-92.5877 343.9467,-62.2372"/>
<polygon fill="#ff7f00" stroke="#ff7f00" points="346.2438,-59.5963 336.4404,-55.5784 341.5985,-64.8328 346.2438,-59.5963"/>
</g>
<!-- sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge19" class="edge">
<title>sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M528.4586,-524.2094C523.9311,-521.7214 519.63,-518.7649 516,-515.2671 494.9096,-494.9451 463.5579,-415.9308 448.984,-377.0803"/>
<polygon fill="#ffff00" stroke="#ffff00" points="452.2618,-375.8529 445.4982,-367.6979 445.7,-378.2908 452.2618,-375.8529"/>
</g>
<!-- sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge22" class="edge">
<title>sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M526.8569,-533.393C501.2681,-530.2012 467.6412,-523.468 441,-509.2671"/>
</g>
<!-- sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge21" class="edge">
<title>sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M322,-585.2671C260.2568,-579.6294 234.9004,-618.4062 182.5,-585.2671"/>
</g>
<!-- sourcefile~m_logger.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node18" class="node">
<title>sourcefile~m_logger.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node18"><a xlink:href=".././sourcefile/m_logger.f90.html" xlink:title="m_logger.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="219.5,-521.2671 145.5,-521.2671 145.5,-497.2671 219.5,-497.2671 219.5,-521.2671"/>
<text text-anchor="middle" x="182.5" y="-506.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_logger.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_logger.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge20" class="edge">
<title>sourcefile~m_ia_vdw.f90&#45;&gt;sourcefile~m_logger.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M322,-585.2671C276.073,-579.1237 230.3447,-548.3104 204.3353,-527.8539"/>
<polygon fill="#ffff00" stroke="#ffff00" points="206.2779,-524.9238 196.2989,-521.3641 201.88,-530.3698 206.2779,-524.9238"/>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M536.8439,-548.3554C491.5329,-566.0332 400.4299,-595.7582 322,-585.2671"/>
</g>
<!-- sourcefile~m_ia_angle.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge23" class="edge">
<title>sourcefile~m_ia_angle.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M529.6286,-482.1624C524.7656,-479.656 520.0597,-476.7069 516,-473.2671 484.2817,-446.3923 461.4352,-402.6631 449.786,-376.6593"/>
<polygon fill="#7fff00" stroke="#7fff00" points="452.9287,-375.1086 445.7443,-367.3217 446.5046,-377.8892 452.9287,-375.1086"/>
</g>
<!-- sourcefile~m_ia_angle.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge25" class="edge">
<title>sourcefile~m_ia_angle.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M441,-509.2671C378.3627,-475.8787 418.1871,-416.3788 366,-368.2671 350.3389,-353.829 340.112,-360.478 322,-349.2671"/>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M538.0791,-506.2922C511.665,-515.9414 471.3548,-525.4475 441,-509.2671"/>
</g>
<!-- sourcefile~m_ia_angle.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge24" class="edge">
<title>sourcefile~m_ia_angle.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M534.2206,-506.3566C518.2039,-512.1664 498.2751,-518.8166 480,-523.2671 410.9891,-540.073 390.112,-527.1254 322,-547.2671"/>
</g>
<!-- sourcefile~m_ia_external.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge26" class="edge">
<title>sourcefile~m_ia_external.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M551.3894,-440.2428C530.9443,-422.8738 494.0005,-391.7021 480,-381.2671 476.3034,-378.5119 472.3328,-375.7028 468.3906,-372.9985"/>
<polygon fill="#00ff00" stroke="#00ff00" points="470.1751,-369.9808 459.923,-367.3076 466.2704,-375.7906 470.1751,-369.9808"/>
</g>
<!-- sourcefile~m_ia_external.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge28" class="edge">
<title>sourcefile~m_ia_external.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M536.9514,-440.2561C473.1662,-413.4118 324.4569,-350.7757 322,-349.2671"/>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M322,-349.2671C293.5437,-331.6533 258.6951,-317.4103 230.9474,-307.5672"/>
<polygon fill="#00ff00" stroke="#00ff00" points="232.0458,-304.2437 221.451,-304.2708 229.7503,-310.8566 232.0458,-304.2437"/>
</g>
<!-- sourcefile~m_ia_external.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge27" class="edge">
<title>sourcefile~m_ia_external.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M517.482,-451.3492C493.1147,-452.8506 463.9073,-457.8136 441,-471.2671"/>
</g>
<!-- sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge29" class="edge">
<title>sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M541.5863,-63.3531C532.1793,-69.2981 522.1721,-77.3408 516,-87.2671 466.2289,-167.312 514.7278,-208.641 480,-296.2671 474.5027,-310.1379 465.4371,-324.134 457.4293,-335.0112"/>
<polygon fill="#00ff7f" stroke="#00ff7f" points="454.6126,-332.9328 451.3223,-343.0038 460.1748,-337.1828 454.6126,-332.9328"/>
</g>
<!-- sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge31" class="edge">
<title>sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M322,-3.2671C230.3176,4.3837 189.6975,3.102 123,-60.2671 62.2618,-117.9743 47.926,-224.04 44.5437,-270.0273"/>
<polygon fill="#00ff7f" stroke="#00ff7f" points="41.0439,-269.9169 43.9106,-280.1165 48.0301,-270.3553 41.0439,-269.9169"/>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M544.3425,-39.0745C520.2499,-26.1688 479.2596,-7.1343 441,-3.2671"/>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M441,-3.2671C388.3792,2.0517 374.8823,-2.4322 322,-3.2671"/>
</g>
<!-- sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_vector.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge30" class="edge">
<title>sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_vector.f90</title>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M441,-3.2671C408.7899,-.0114 373.8961,-13.9997 350.2763,-26.3176"/>
<polygon fill="#00ff7f" stroke="#00ff7f" points="348.3005,-23.4082 341.192,-31.2644 351.6482,-29.5558 348.3005,-23.4082"/>
</g>
<!-- sourcefile~m_table.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node19" class="node">
<title>sourcefile~m_table.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node19"><a xlink:href=".././sourcefile/m_table.f90.html" xlink:title="m_table.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="474.5,-55.2671 407.5,-55.2671 407.5,-31.2671 474.5,-31.2671 474.5,-55.2671"/>
<text text-anchor="middle" x="441" y="-40.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_table.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_table.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge32" class="edge">
<title>sourcefile~m_connectivity.f90&#45;&gt;sourcefile~m_table.f90</title>
<path fill="none" stroke="#00ff7f" stroke-dasharray="5,2" d="M515.9366,-48.0823C505.6696,-47.4226 494.9218,-46.732 484.8754,-46.0864"/>
<polygon fill="#00ff7f" stroke="#00ff7f" points="484.9133,-42.5817 474.7094,-45.4332 484.4644,-49.5673 484.9133,-42.5817"/>
</g>
<!-- sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge33" class="edge">
<title>sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M534.9288,-120.3314C527.8059,-124.431 520.8852,-129.6875 516,-136.2671 472.5493,-194.7891 508.5653,-229.2088 480,-296.2671 474.1527,-309.994 465.0693,-323.9828 457.1394,-334.892"/>
<polygon fill="#00ffff" stroke="#00ffff" points="454.3189,-332.8194 451.111,-342.917 459.9156,-337.0238 454.3189,-332.8194"/>
</g>
<!-- sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge35" class="edge">
<title>sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M441,-83.2671C368.9884,-69.9891 347.4527,-84.066 278,-107.2671 232.1614,-122.5798 227.0438,-140.5187 182.5,-159.2671"/>
</g>
<!-- sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_vector.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge34" class="edge">
<title>sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_vector.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M441,-83.2671C413.055,-78.1144 382.7093,-67.8355 359.656,-58.9881"/>
<polygon fill="#00ffff" stroke="#00ffff" points="360.8384,-55.6924 350.2508,-55.3031 358.2848,-62.21 360.8384,-55.6924"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M530.4071,-100.9119C505.4961,-95.7663 471.2444,-88.8438 441,-83.2671"/>
</g>
<!-- sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_table.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge36" class="edge">
<title>sourcefile~m_verlet.f90&#45;&gt;sourcefile~m_table.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M542.3743,-96.1934C522.8948,-86.0234 494.8196,-71.3657 473.1517,-60.0531"/>
<polygon fill="#00ffff" stroke="#00ffff" points="474.4863,-56.8016 464.0019,-55.2761 471.2466,-63.0069 474.4863,-56.8016"/>
</g>
<!-- sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge38" class="edge">
<title>sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M528.8193,-326.3467C515.8904,-330.6044 501.1805,-335.4486 487.5459,-339.9387"/>
<polygon fill="#007fff" stroke="#007fff" points="486.2522,-336.6798 477.8488,-343.1322 488.4418,-343.3285 486.2522,-336.6798"/>
</g>
<!-- sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge39" class="edge">
<title>sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M322,-311.2671C299.7709,-304.5918 274.8393,-300.2545 252.2684,-297.4391"/>
<polygon fill="#007fff" stroke="#007fff" points="252.4207,-293.9332 242.0823,-296.2497 251.6088,-300.886 252.4207,-293.9332"/>
</g>
<!-- sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge41" class="edge">
<title>sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M524.3931,-320.5302C475.1283,-326.5101 390.6326,-331.8771 322,-311.2671"/>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M322,-311.2671C235.3577,-281.2526 267.0129,-123.6957 182.5,-159.2671"/>
</g>
<!-- sourcefile~m_strings.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node14" class="node">
<title>sourcefile~m_strings.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node14"><a xlink:href=".././sourcefile/m_strings.f90.html" xlink:title="m_strings.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="479,-287.2671 403,-287.2671 403,-263.2671 479,-263.2671 479,-287.2671"/>
<text text-anchor="middle" x="441" y="-272.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_strings.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_strings.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge37" class="edge">
<title>sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_strings.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M527.13,-302.2476C514.946,-298.4309 501.3234,-294.1636 488.5721,-290.1692"/>
<polygon fill="#007fff" stroke="#007fff" points="489.6183,-286.8293 479.0293,-287.1799 487.5258,-293.5092 489.6183,-286.8293"/>
</g>
<!-- sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_logger.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge40" class="edge">
<title>sourcefile~m_ia_bond.f90&#45;&gt;sourcefile~m_logger.f90</title>
<path fill="none" stroke="#007fff" stroke-dasharray="5,2" d="M531.3861,-326.3283C526.0135,-328.8976 520.6912,-331.8772 516,-335.2671 496.3448,-349.47 496.5823,-358.5731 480,-376.2671 473.8753,-382.8024 374.0871,-486.4174 366,-490.2671 323.1779,-510.6516 268.4993,-513.8111 230.008,-512.8523"/>
<polygon fill="#007fff" stroke="#007fff" points="229.7217,-509.3401 219.604,-512.4835 229.4737,-516.3357 229.7217,-509.3401"/>
</g>
<!-- sourcefile~m_constants_math.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge42" class="edge">
<title>sourcefile~m_constants_math.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#0000ff" stroke-dasharray="5,2" d="M122.7448,-292.2671C114.3634,-292.2671 105.7891,-292.2671 97.5226,-292.2671"/>
<polygon fill="#0000ff" stroke="#0000ff" points="97.254,-288.7672 87.2539,-292.2671 97.2539,-295.7672 97.254,-288.7672"/>
</g>
<!-- sourcefile~m_ia_tether.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge43" class="edge">
<title>sourcefile~m_ia_tether.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M558.0851,-169.6228C543.4175,-193.9963 509.5567,-249.9271 480,-296.2671 471.7681,-309.1733 462.3045,-323.5018 454.7612,-334.8064"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="451.8376,-332.8821 449.1836,-343.1392 457.6547,-336.7759 451.8376,-332.8821"/>
</g>
<!-- sourcefile~m_ia_tether.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge45" class="edge">
<title>sourcefile~m_ia_tether.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M322,-121.2671C251.7768,-144.6525 208.0986,-230.1206 190.8914,-270.6563"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="187.5542,-269.5698 186.9996,-280.1501 194.0311,-272.225 187.5542,-269.5698"/>
</g>
<!-- sourcefile~m_ia_tether.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge44" class="edge">
<title>sourcefile~m_ia_tether.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M538.1235,-145.1799C492.2911,-126.7009 397.6159,-96.0859 322,-121.2671"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M322,-121.2671C261.2054,-142.0817 241.7267,-134.3386 182.5,-159.2671"/>
</g>
<!-- sourcefile~m_ia_dihedral.f90&#45;&gt;sourcefile~m_globals.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge46" class="edge">
<title>sourcefile~m_ia_dihedral.f90&#45;&gt;sourcefile~m_globals.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M533.3993,-284.276C527.4604,-286.9439 521.4249,-289.9708 516,-293.2671 495.7784,-305.5543 475.2336,-322.9554 460.7724,-336.1966"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="458.3321,-333.6865 453.4049,-343.0659 463.1058,-338.8063 458.3321,-333.6865"/>
</g>
<!-- sourcefile~m_ia_dihedral.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge48" class="edge">
<title>sourcefile~m_ia_dihedral.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M441,-235.2671C359.7074,-216.7808 263.8225,-253.1159 214.8463,-275.8603"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="213.2255,-272.7553 205.6947,-280.2076 216.2292,-279.0781 213.2255,-272.7553"/>
</g>
<!-- sourcefile~m_ia_dihedral.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge47" class="edge">
<title>sourcefile~m_ia_dihedral.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M441,-235.2671C401.1069,-223.4726 404.7098,-194.5027 366,-179.2671 289.6614,-149.2214 258.0185,-127.216 182.5,-159.2671"/>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M525.7564,-260.2103C501.3423,-252.8651 469.407,-243.3663 441,-235.2671"/>
</g>
<!-- sourcefile~m_strings.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge49" class="edge">
<title>sourcefile~m_strings.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M422.8814,-263.031C372.3034,-229.5321 230.1818,-140.0637 182.5,-159.2671"/>
</g>
<!-- sourcefile~m_trajectory.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge51" class="edge">
<title>sourcefile~m_trajectory.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M277.807,-459.2414C249.9462,-452.2782 213.5045,-441.9782 182.5,-429.2671"/>
</g>
<!-- sourcefile~m_trajectory.f90&#45;&gt;sourcefile~m_logger.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge50" class="edge">
<title>sourcefile~m_trajectory.f90&#45;&gt;sourcefile~m_logger.f90</title>
<path fill="none" stroke="#ffff00" stroke-dasharray="5,2" d="M280.1454,-481.2684C264.1947,-485.8421 245.9138,-491.0839 229.5153,-495.786"/>
<polygon fill="#ffff00" stroke="#ffff00" points="228.2337,-492.5124 219.5858,-498.6332 230.1632,-499.2412 228.2337,-492.5124"/>
</g>
<!-- sourcefile~m_simbox.f90&#45;&gt;sourcefile~m_constants_math.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge54" class="edge">
<title>sourcefile~m_simbox.f90&#45;&gt;sourcefile~m_constants_math.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M300.2357,-377.0182C293.0556,-372.8162 285.0944,-367.9814 278,-363.2671 252.6328,-346.4105 224.8119,-325.423 205.7756,-310.6523"/>
<polygon fill="#00ff00" stroke="#00ff00" points="207.7246,-307.7336 197.6878,-304.3405 203.4179,-313.2521 207.7246,-307.7336"/>
</g>
<!-- sourcefile~m_simbox.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge53" class="edge">
<title>sourcefile~m_simbox.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M294.7706,-401.3835C260.2669,-415.9911 202.8394,-437.6058 182.5,-429.2671"/>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M182.5,-429.2671C124.8613,-405.6367 78.3196,-345.2873 56.664,-313.1477"/>
<polygon fill="#00ff00" stroke="#00ff00" points="59.4089,-310.9515 50.9918,-304.5171 53.5592,-314.7962 59.4089,-310.9515"/>
</g>
<!-- sourcefile~m_ran_num.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node20" class="node">
<title>sourcefile~m_ran_num.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node20"><a xlink:href=".././sourcefile/m_ran_num.f90.html" xlink:title="m_ran_num.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="225.5,-374.2671 139.5,-374.2671 139.5,-350.2671 225.5,-350.2671 225.5,-374.2671"/>
<text text-anchor="middle" x="182.5" y="-359.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_ran_num.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_simbox.f90&#45;&gt;sourcefile~m_ran_num.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge52" class="edge">
<title>sourcefile~m_simbox.f90&#45;&gt;sourcefile~m_ran_num.f90</title>
<path fill="none" stroke="#00ff00" stroke-dasharray="5,2" d="M282.7702,-381.6742C268.2268,-378.8594 251.4782,-375.6177 235.8858,-372.5998"/>
<polygon fill="#00ff00" stroke="#00ff00" points="236.3241,-369.1198 225.8412,-370.6557 234.9939,-375.9922 236.3241,-369.1198"/>
</g>
<!-- sourcefile~m_vector.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge56" class="edge">
<title>sourcefile~m_vector.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M299.449,-55.3032C292.3693,-59.4176 284.6662,-64.2546 278,-69.2671 231.385,-104.3181 236.6,-137.4789 182.5,-159.2671"/>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M182.5,-159.2671C125.8228,-182.0933 79.1666,-240.2153 57.1527,-271.5306"/>
<polygon fill="#00ffff" stroke="#00ffff" points="54.14,-269.735 51.3679,-279.9608 59.9118,-273.6956 54.14,-269.735"/>
</g>
<!-- sourcefile~m_qsort.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_node21" class="node">
<title>sourcefile~m_qsort.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~EfferentGraph_node21"><a xlink:href=".././sourcefile/m_qsort.f90.html" xlink:title="m_qsort.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="216.5,-93.2671 148.5,-93.2671 148.5,-69.2671 216.5,-69.2671 216.5,-93.2671"/>
<text text-anchor="middle" x="182.5" y="-78.8671" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_qsort.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_vector.f90&#45;&gt;sourcefile~m_qsort.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge55" class="edge">
<title>sourcefile~m_vector.f90&#45;&gt;sourcefile~m_qsort.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M285.348,-53.2512C267.2832,-58.172 245.3623,-64.1433 226.4071,-69.3067"/>
<polygon fill="#00ffff" stroke="#00ffff" points="225.2425,-65.9964 216.514,-72.0016 227.0824,-72.7503 225.2425,-65.9964"/>
</g>
<!-- sourcefile~m_table.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge58" class="edge">
<title>sourcefile~m_table.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M416.6741,-31.2244C393.1322,-20.5126 356.1006,-6.1127 322,-3.2671"/>
</g>
<!-- sourcefile~m_table.f90&#45;&gt;sourcefile~m_vector.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge57" class="edge">
<title>sourcefile~m_table.f90&#45;&gt;sourcefile~m_vector.f90</title>
<path fill="none" stroke="#ff00ff" stroke-dasharray="5,2" d="M407.2177,-43.2671C395.2893,-43.2671 381.6534,-43.2671 368.839,-43.2671"/>
<polygon fill="#ff00ff" stroke="#ff00ff" points="368.7866,-39.7672 358.7866,-43.2671 368.7866,-46.7672 368.7866,-39.7672"/>
</g>
<!-- sourcefile~m_ran_num.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge59" class="edge">
<title>sourcefile~m_ran_num.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M158.605,-350.2337C136.0294,-338.8646 101.9594,-321.7071 76.7387,-309.006"/>
<polygon fill="#ff0000" stroke="#ff0000" points="78.054,-305.7496 67.5483,-304.3778 74.9055,-312.0016 78.054,-305.7496"/>
</g>
<!-- sourcefile~m_qsort.f90&#45;&gt;sourcefile~m_precision.f90 -->
<g id="sourcefile~~m_interaction.f90~~EfferentGraph_edge60" class="edge">
<title>sourcefile~m_qsort.f90&#45;&gt;sourcefile~m_precision.f90</title>
<path fill="none" stroke="#00ffff" stroke-dasharray="5,2" d="M169.1609,-93.6608C156.3635,-105.977 136.9738,-125.7912 123,-145.2671 93.0423,-187.0204 66.4832,-241.3638 52.9599,-270.8898"/>
<polygon fill="#00ffff" stroke="#00ffff" points="49.6645,-269.6831 48.7361,-280.2372 56.0435,-272.5656 49.6645,-269.6831"/>
</g>
</g>
</svg>
</div><script>var pansourcefilem_interactionf90EfferentGraph = svgPanZoom('#sourcefilem_interactionf90EfferentGraph', {zoomEnabled: true,controlIconsEnabled: true, fit: true, center: true,}); </script><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,0 66,0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="180,-24 84,-24 84,0 180,0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">Files dependent on this one</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: sourcefile~~m_interaction.f90~~AfferentGraph Pages: 1 -->
<svg id="sourcefilem_interactionf90AfferentGraph" width="423pt" height="192pt"
 viewBox="0.00 0.00 423.00 192.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~m_interaction.f90~~AfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 188)">
<title>sourcefile~~m_interaction.f90~~AfferentGraph</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-188 419,-188 419,4 -4,4"/>
<!-- sourcefile~m_interaction.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_node1" class="node">
<title>sourcefile~m_interaction.f90</title>
<polygon fill="none" stroke="#000000" points="93,-104 0,-104 0,-80 93,-80 93,-104"/>
<text text-anchor="middle" x="46.5" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">m_interaction.f90</text>
</g>
<!-- sourcefile~m_mpcd.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_node2" class="node">
<title>sourcefile~m_mpcd.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~AfferentGraph_node2"><a xlink:href=".././sourcefile/m_mpcd.f90.html" xlink:title="m_mpcd.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="209,-184 139,-184 139,-160 209,-160 209,-184"/>
<text text-anchor="middle" x="174" y="-169.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_mpcd.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_mpcd.f90&#45;&gt;sourcefile~m_interaction.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge1" class="edge">
<title>sourcefile~m_mpcd.f90&#45;&gt;sourcefile~m_interaction.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M152.3399,-159.8099C144.8897,-155.5314 136.5302,-150.6349 129,-146 109.9345,-134.2651 88.8177,-120.427 72.7213,-109.6973"/>
<polygon fill="#ff0000" stroke="#ff0000" points="74.5977,-106.7416 64.3402,-104.0892 70.7048,-112.5593 74.5977,-106.7416"/>
</g>
<!-- sourcefile~m_bd_solver.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_node3" class="node">
<title>sourcefile~m_bd_solver.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~AfferentGraph_node3"><a xlink:href=".././sourcefile/m_bd_solver.f90.html" xlink:title="m_bd_solver.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="219,-104 129,-104 129,-80 219,-80 219,-104"/>
<text text-anchor="middle" x="174" y="-89.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_bd_solver.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_bd_solver.f90&#45;&gt;sourcefile~m_interaction.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge2" class="edge">
<title>sourcefile~m_bd_solver.f90&#45;&gt;sourcefile~m_interaction.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M128.6893,-92C120.5474,-92 111.9666,-92 103.5436,-92"/>
<polygon fill="#ff0000" stroke="#ff0000" points="103.3879,-88.5001 93.3879,-92 103.3879,-95.5001 103.3879,-88.5001"/>
</g>
<!-- sourcefile~m_setup.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_node4" class="node">
<title>sourcefile~m_setup.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~AfferentGraph_node4"><a xlink:href=".././sourcefile/m_setup.f90.html" xlink:title="m_setup.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="325,-144 255,-144 255,-120 325,-120 325,-144"/>
<text text-anchor="middle" x="290" y="-129.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_setup.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_setup.f90&#45;&gt;sourcefile~m_interaction.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge3" class="edge">
<title>sourcefile~m_setup.f90&#45;&gt;sourcefile~m_interaction.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M254.9394,-129.204C222.1899,-126.2759 172.0324,-120.9801 129,-113 119.401,-111.2199 109.263,-108.9603 99.5031,-106.5872"/>
<polygon fill="#ff0000" stroke="#ff0000" points="100.058,-103.1183 89.5077,-104.0884 98.3602,-109.9093 100.058,-103.1183"/>
</g>
<!-- sourcefile~m_setup.f90&#45;&gt;sourcefile~m_mpcd.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge7" class="edge">
<title>sourcefile~m_setup.f90&#45;&gt;sourcefile~m_mpcd.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M255.1962,-144.0013C243.7166,-147.9598 230.7856,-152.4187 218.6742,-156.5951"/>
<polygon fill="#ff0000" stroke="#ff0000" points="217.4929,-153.3001 209.1802,-159.8689 219.7749,-159.9177 217.4929,-153.3001"/>
</g>
<!-- sourcefile~m_setup.f90&#45;&gt;sourcefile~m_bd_solver.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge9" class="edge">
<title>sourcefile~m_setup.f90&#45;&gt;sourcefile~m_bd_solver.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M255.1962,-119.9987C243.7166,-116.0402 230.7856,-111.5813 218.6742,-107.4049"/>
<polygon fill="#cbff00" stroke="#cbff00" points="219.7749,-104.0823 209.1802,-104.1311 217.4929,-110.6999 219.7749,-104.0823"/>
</g>
<!-- sourcefile~m_kmc.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_node5" class="node">
<title>sourcefile~m_kmc.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~AfferentGraph_node5"><a xlink:href=".././sourcefile/m_kmc.f90.html" xlink:title="m_kmc.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="206,-24 142,-24 142,0 206,0 206,-24"/>
<text text-anchor="middle" x="174" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_kmc.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_kmc.f90&#45;&gt;sourcefile~m_interaction.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge4" class="edge">
<title>sourcefile~m_kmc.f90&#45;&gt;sourcefile~m_interaction.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M152.3399,-24.1901C144.8897,-28.4686 136.5302,-33.3651 129,-38 109.9345,-49.7349 88.8177,-63.573 72.7213,-74.3027"/>
<polygon fill="#ff0000" stroke="#ff0000" points="70.7048,-71.4407 64.3402,-79.9108 74.5977,-77.2584 70.7048,-71.4407"/>
</g>
<!-- sourcefile~m_relax.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_node6" class="node">
<title>sourcefile~m_relax.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~AfferentGraph_node6"><a xlink:href=".././sourcefile/m_relax.f90.html" xlink:title="m_relax.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="323.5,-64 256.5,-64 256.5,-40 323.5,-40 323.5,-64"/>
<text text-anchor="middle" x="290" y="-49.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">m_relax.f90</text>
</a>
</g>
</g>
<!-- sourcefile~m_relax.f90&#45;&gt;sourcefile~m_interaction.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge5" class="edge">
<title>sourcefile~m_relax.f90&#45;&gt;sourcefile~m_interaction.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M256.1943,-54.6842C223.4813,-57.5883 172.5858,-62.9173 129,-71 119.401,-72.7801 109.263,-75.0397 99.5031,-77.4128"/>
<polygon fill="#ff0000" stroke="#ff0000" points="98.3602,-74.0907 89.5077,-79.9116 100.058,-80.8817 98.3602,-74.0907"/>
</g>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_node7" class="node">
<title>sourcefile~main.f90</title>
<g id="a_sourcefile~~m_interaction.f90~~AfferentGraph_node7"><a xlink:href=".././sourcefile/main.f90.html" xlink:title="main.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="415,-124 361,-124 361,-100 415,-100 415,-124"/>
<text text-anchor="middle" x="388" y="-109.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">main.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~m_mpcd.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge6" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~m_mpcd.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M373.506,-124.1882C361.3584,-133.6927 343.1357,-146.3583 325,-153 291.0435,-165.4356 250.2358,-170.0051 219.608,-171.5649"/>
<polygon fill="#ff0000" stroke="#ff0000" points="219.0721,-168.0842 209.2271,-171.9991 219.3646,-175.0781 219.0721,-168.0842"/>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~m_bd_solver.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge8" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~m_bd_solver.f90</title>
<path fill="none" stroke="#cbff00" stroke-dasharray="5,2" d="M360.8968,-109.467C327.9597,-106.3888 271.556,-101.1174 229.3063,-97.1688"/>
<polygon fill="#cbff00" stroke="#cbff00" points="229.4476,-93.6669 219.1653,-96.2211 228.7962,-100.6365 229.4476,-93.6669"/>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~m_setup.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge10" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~m_setup.f90</title>
<path fill="none" stroke="#00ff66" stroke-dasharray="5,2" d="M360.9616,-117.518C352.8936,-119.1646 343.824,-121.0155 334.9341,-122.8298"/>
<polygon fill="#00ff66" stroke="#00ff66" points="334.1346,-119.4207 325.0365,-124.8497 335.5344,-126.2793 334.1346,-119.4207"/>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~m_relax.f90 -->
<g id="sourcefile~~m_interaction.f90~~AfferentGraph_edge11" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~m_relax.f90</title>
<path fill="none" stroke="#cc00ff" stroke-dasharray="5,2" d="M368.1682,-99.8581C353.9552,-91.1562 334.5942,-79.3026 318.697,-69.5696"/>
<polygon fill="#cc00ff" stroke="#cc00ff" points="320.1584,-66.3604 309.8023,-64.1238 316.5032,-72.3304 320.1584,-66.3604"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.40.1 (20161225.0304)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="188pt" height="32pt"
 viewBox="0.00 0.00 188.00 32.00" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 28)">
<title>Graph Key</title>
<polygon fill="#ffffff" stroke="transparent" points="-4,4 -4,-28 184,-28 184,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="66,-24 0,-24 0,0 66,0 66,-24"/>
<text text-anchor="middle" x="33" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#ffffff">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="#000000" points="180,-24 84,-24 84,0 180,0 180,-24"/>
<text text-anchor="middle" x="132" y="-9.6" font-family="Helvetica,sans-Serif" font-size="10.50" fill="#000000">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 







<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#mods-1">Modules</a></h3></div>
  <div id="mods-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../module/m_interaction.html">m_interaction</a>
      
    </div>
  </div>
</div>
















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/m_interaction.f90.html#src">m_interaction.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="k">module </span><span class="n">m_interaction</span>
<a name="ln-2"></a><span class="c">!! Driver routines for force &amp; energy calculation.</span>
<a name="ln-3"></a>
<a name="ln-4"></a><span class="k">use </span><span class="n">m_precision</span>
<a name="ln-5"></a><span class="k">use </span><span class="n">m_constants_math</span>
<a name="ln-6"></a><span class="k">use </span><span class="n">m_globals</span>
<a name="ln-7"></a><span class="k">use </span><span class="n">m_connectivity</span>
<a name="ln-8"></a><span class="k">use </span><span class="n">m_verlet</span>
<a name="ln-9"></a><span class="k">use </span><span class="n">m_cell_list</span>
<a name="ln-10"></a><span class="k">use </span><span class="n">m_ia_bond</span>
<a name="ln-11"></a><span class="k">use </span><span class="n">m_ia_angle</span>
<a name="ln-12"></a><span class="k">use </span><span class="n">m_ia_dihedral</span>
<a name="ln-13"></a><span class="k">use </span><span class="n">m_ia_vdw</span>
<a name="ln-14"></a><span class="k">use </span><span class="n">m_ia_tether</span>
<a name="ln-15"></a><span class="k">use </span><span class="n">m_ia_external</span>
<a name="ln-16"></a>
<a name="ln-17"></a><span class="k">implicit none</span>
<a name="ln-18"></a>
<a name="ln-19"></a><span class="k">private</span>
<a name="ln-20"></a>
<a name="ln-21"></a><span class="k">public</span> <span class="kd">::</span> <span class="n">ia_setup</span><span class="p">,</span> <span class="n">ia_finish</span><span class="p">,</span> <span class="n">ia_calc_forces</span>
<a name="ln-22"></a>
<a name="ln-23"></a><span class="k">contains</span>
<a name="ln-24"></a>
<a name="ln-25"></a><span class="c">!******************************************************************************</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="k">subroutine </span><span class="n">ia_setup</span><span class="p">()</span>
<a name="ln-28"></a>    <span class="c">!! Sets up parameters for potentials </span>
<a name="ln-29"></a>
<a name="ln-30"></a>    <span class="c">!Initialize and build atom -&gt; bond, atom -&gt; atom and next nearest bonded</span>
<a name="ln-31"></a>    <span class="c">!neighbor tables</span>
<a name="ln-32"></a>    <span class="k">call </span><span class="n">atbo_build</span><span class="p">()</span>
<a name="ln-33"></a>
<a name="ln-34"></a>    <span class="c">!Debug statements</span>
<a name="ln-35"></a>    <span class="c">!write(*,*) &#39;ATBO_TAB&#39;</span>
<a name="ln-36"></a>    <span class="c">!call atbo_tab%print()</span>
<a name="ln-37"></a>
<a name="ln-38"></a>    <span class="c">!Build excluded atoms table</span>
<a name="ln-39"></a>    <span class="k">call </span><span class="n">exat_build</span><span class="p">()</span>
<a name="ln-40"></a>
<a name="ln-41"></a>    <span class="c">!Debug statements</span>
<a name="ln-42"></a>    <span class="c">!write(*,*) &#39;EXAT_TAB&#39;</span>
<a name="ln-43"></a>    <span class="c">!call exat_tab%print()</span>
<a name="ln-44"></a>
<a name="ln-45"></a>    <span class="c">!Delete atom -&gt; bond table, it is no longer needed.</span>
<a name="ln-46"></a>    <span class="k">call </span><span class="n">atbo_tab</span><span class="p">%</span><span class="n">delete</span><span class="p">()</span>
<a name="ln-47"></a>
<a name="ln-48"></a>    <span class="c">!Check</span>
<a name="ln-49"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_vdw_types</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="n">lvdw</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-50"></a>
<a name="ln-51"></a>    <span class="k">if</span> <span class="p">((</span><span class="n">imcon</span><span class="o">==</span><span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">use_cell_list</span><span class="p">)</span> <span class="n">use_cell_list</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-52"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">use_verlet_tab</span> <span class="p">.</span><span class="nb">and</span><span class="p">.</span> <span class="n">use_cell_list</span><span class="p">)</span> <span class="n">use_verlet_tab</span> <span class="o">=</span> <span class="p">.</span><span class="n">false</span><span class="p">.</span>
<a name="ln-53"></a>
<a name="ln-54"></a>    <span class="c">!Initialize verlet list</span>
<a name="ln-55"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">use_verlet_tab</span><span class="p">)</span> <span class="k">call </span><span class="n">verlet_init</span><span class="p">(</span><span class="n">rcutoff</span><span class="o">+</span><span class="n">tskin</span><span class="p">,</span> <span class="n">tskin</span><span class="p">)</span>
<a name="ln-56"></a>
<a name="ln-57"></a>    <span class="c">!Initialize cell list</span>
<a name="ln-58"></a>    <span class="k">if</span> <span class="p">(</span> <span class="p">(</span><span class="n">sim_style</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">.</span><span class="nb">or</span><span class="p">.</span> <span class="p">(</span><span class="n">sim_style</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-59"></a>        <span class="c">! For relaxation/BD simulation the cell list is used for short range</span>
<a name="ln-60"></a>        <span class="c">! force calculation.</span>
<a name="ln-61"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">use_cell_list</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-62"></a><span class="k">            call </span><span class="n">cl_init</span><span class="p">(</span><span class="n">num_atoms</span><span class="p">,</span> <span class="n">rcutoff</span><span class="p">)</span>
<a name="ln-63"></a>            <span class="k">call </span><span class="n">cl_set_cell_size</span><span class="p">(</span><span class="n">rcutoff</span><span class="p">)</span>
<a name="ln-64"></a>            <span class="k">call </span><span class="n">cl_build_cell_nbrs</span><span class="p">()</span>
<a name="ln-65"></a>        <span class="k">end if</span>
<a name="ln-66"></a><span class="k">    else if</span> <span class="p">(</span><span class="n">sim_style</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-67"></a>        <span class="c">! For MPCD simulation the cell list is always used for sorting. If</span>
<a name="ln-68"></a>        <span class="c">! use_cell_list == .true., the cell list will also be used for force</span>
<a name="ln-69"></a>        <span class="c">! calculation.</span>
<a name="ln-70"></a>        <span class="k">call </span><span class="n">cl_init</span><span class="p">(</span><span class="n">num_atoms_tot</span><span class="p">,</span> <span class="mf">1.0_rp</span><span class="p">)</span> <span class="c">!Collision cell size is 1.0.</span>
<a name="ln-71"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">use_cell_list</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-72"></a><span class="k">            call </span><span class="n">cl_set_cell_size</span><span class="p">(</span><span class="n">rcutoff</span><span class="p">)</span> <span class="c">!Set cell size to global cutoff </span>
<a name="ln-73"></a>            <span class="k">call </span><span class="n">cl_build_cell_nbrs</span><span class="p">()</span>
<a name="ln-74"></a>        <span class="k">end if</span>
<a name="ln-75"></a><span class="k">    end if</span>
<a name="ln-76"></a>
<a name="ln-77"></a><span class="k">    if</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_bond_setup</span><span class="p">()</span>
<a name="ln-78"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_angles</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_angle_setup</span><span class="p">()</span>
<a name="ln-79"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_dihedrals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_dihedral_setup</span><span class="p">()</span>
<a name="ln-80"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_tethers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_tether_setup</span><span class="p">()</span>
<a name="ln-81"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">lvdw</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_vdw_setup</span><span class="p">()</span>
<a name="ln-82"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_externals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_external_setup</span><span class="p">()</span>
<a name="ln-83"></a>
<a name="ln-84"></a>    <span class="k">end subroutine</span>
<a name="ln-85"></a>
<a name="ln-86"></a><span class="c">!******************************************************************************</span>
<a name="ln-87"></a>
<a name="ln-88"></a><span class="k">subroutine </span><span class="n">ia_finish</span><span class="p">()</span>
<a name="ln-89"></a>    <span class="c">!! Releases memory allocated in `ia_setup`.</span>
<a name="ln-90"></a>
<a name="ln-91"></a>    <span class="k">call </span><span class="n">exat_tab</span><span class="p">%</span><span class="n">delete</span><span class="p">()</span>
<a name="ln-92"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">use_verlet_tab</span><span class="p">)</span> <span class="k">call </span><span class="n">verlet_delete</span><span class="p">()</span>
<a name="ln-93"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">use_cell_list</span><span class="p">)</span> <span class="k">call </span><span class="n">cl_delete</span><span class="p">()</span>
<a name="ln-94"></a>
<a name="ln-95"></a>    <span class="k">end subroutine</span>
<a name="ln-96"></a>
<a name="ln-97"></a><span class="c">!******************************************************************************</span>
<a name="ln-98"></a>
<a name="ln-99"></a><span class="k">subroutine </span><span class="n">ia_calc_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-100"></a>    <span class="c">!! Calculates total forces and energies</span>
<a name="ln-101"></a>
<a name="ln-102"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-103"></a>
<a name="ln-104"></a>    <span class="n">ierr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-105"></a>
<a name="ln-106"></a>    <span class="c">!Zeroing out force, energies, &amp; bond length</span>
<a name="ln-107"></a>    <span class="n">forces</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-108"></a>
<a name="ln-109"></a>    <span class="n">energy_bond</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-110"></a>    <span class="n">energy_angle</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-111"></a>    <span class="n">energy_dihedral</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-112"></a>    <span class="n">energy_tether</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-113"></a>    <span class="n">energy_vdw</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-114"></a>    <span class="n">energy_external</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-115"></a>    <span class="n">energy_tot</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-116"></a>    <span class="n">stress</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-117"></a>
<a name="ln-118"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-119"></a><span class="k">        </span><span class="n">bndlen</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-120"></a>        <span class="n">bndlen_min</span> <span class="o">=</span> <span class="nb">huge</span><span class="p">(</span><span class="mf">0.0_rp</span><span class="p">)</span>
<a name="ln-121"></a>        <span class="n">bndlen_max</span> <span class="o">=</span> <span class="mf">0.0_rp</span>
<a name="ln-122"></a>    <span class="k">end if</span>
<a name="ln-123"></a>
<a name="ln-124"></a>    <span class="c">!Calculation of bonded interactions</span>
<a name="ln-125"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_bonds</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-126"></a><span class="k">        call </span><span class="n">ia_add_bond_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-127"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-128"></a><span class="k">    end if</span>
<a name="ln-129"></a>
<a name="ln-130"></a>    <span class="c">!Calculation of angular interactions</span>
<a name="ln-131"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_angles</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_add_angle_forces</span><span class="p">()</span>
<a name="ln-132"></a>
<a name="ln-133"></a>    <span class="c">!Calculation of dihedral interactions</span>
<a name="ln-134"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_dihedrals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">ia_add_dihedral_forces</span><span class="p">()</span>
<a name="ln-135"></a>
<a name="ln-136"></a>    <span class="c">!Calculation of tether interactions</span>
<a name="ln-137"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_tethers</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-138"></a><span class="k">        call </span><span class="n">ia_add_tether_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-139"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-140"></a><span class="k">    end if</span>
<a name="ln-141"></a>
<a name="ln-142"></a>    <span class="c">!Calculation for pairwise interactions</span>
<a name="ln-143"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">lvdw</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-144"></a><span class="k">        if</span> <span class="p">(</span><span class="n">use_verlet_tab</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-145"></a><span class="k">            call </span><span class="n">ia_add_vdw_forces_vl</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-146"></a>        <span class="k">else if</span> <span class="p">(</span><span class="n">use_cell_list</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-147"></a><span class="k">            call </span><span class="n">ia_add_vdw_forces_cl</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-148"></a>        <span class="k">else</span>
<a name="ln-149"></a><span class="k">            call </span><span class="n">ia_add_vdw_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-150"></a>        <span class="k">end if</span>
<a name="ln-151"></a><span class="k">        if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-152"></a><span class="k">    end if</span>
<a name="ln-153"></a>
<a name="ln-154"></a>    <span class="c">!Calculation of external interactions</span>
<a name="ln-155"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">num_externals</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-156"></a><span class="k">        call </span><span class="n">ia_add_external_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-157"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-158"></a><span class="k">    end if</span>
<a name="ln-159"></a>
<a name="ln-160"></a>    <span class="c">!Calculate total energy</span>
<a name="ln-161"></a>    <span class="n">energy_tot</span> <span class="o">=</span> <span class="n">energy_bond</span> <span class="o">+</span> <span class="n">energy_angle</span> <span class="o">+</span> <span class="n">energy_dihedral</span> <span class="o">+</span> <span class="n">energy_vdw</span> <span class="p">&amp;</span>
<a name="ln-162"></a>        <span class="o">+</span> <span class="n">energy_tether</span> <span class="o">+</span> <span class="n">energy_external</span>
<a name="ln-163"></a>
<a name="ln-164"></a>    <span class="c">!Update stress considering volume for finite concentration</span>
<a name="ln-165"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="n">stress</span> <span class="o">=</span> <span class="n">stress</span><span class="o">/</span><span class="n">simbox</span><span class="p">%</span><span class="n">volume</span>
<a name="ln-166"></a>
<a name="ln-167"></a>    <span class="k">end subroutine</span>
<a name="ln-168"></a>
<a name="ln-169"></a><span class="c">!********************************************************************************</span>
<a name="ln-170"></a>
<a name="ln-171"></a><span class="k">subroutine </span><span class="n">ia_add_vdw_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-172"></a>    <span class="c">!! Calculates force and energy due to all short-ranged non-bonded pairwise</span>
<a name="ln-173"></a>    <span class="c">!! interactions and adds to `energy_vdw` &amp; &#39;forces` in module `m_globals`.</span>
<a name="ln-174"></a>    <span class="c">!! Uses direct N^2 calculation.</span>
<a name="ln-175"></a>
<a name="ln-176"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-177"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ri</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">rij</span><span class="p">,</span> <span class="n">fi</span>
<a name="ln-178"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rij_mag</span>
<a name="ln-179"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qi</span><span class="p">,</span> <span class="n">qj</span>
<a name="ln-180"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span>
<a name="ln-181"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">at_i</span><span class="p">,</span> <span class="n">at_j</span><span class="p">,</span> <span class="n">typ</span>
<a name="ln-182"></a>
<a name="ln-183"></a>    <span class="n">ierr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-184"></a>
<a name="ln-185"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_atoms</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-186"></a>        <span class="n">ri</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-187"></a>        <span class="n">qi</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-188"></a>        <span class="n">at_i</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-189"></a>        <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_atoms</span>
<a name="ln-190"></a>            <span class="c">!Check if atom j is an excluded atom for atom i</span>
<a name="ln-191"></a>            <span class="k">if</span> <span class="p">(</span> <span class="n">exat_tab</span><span class="p">%</span><span class="n">is_in</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span> <span class="k">cycle</span>
<a name="ln-192"></a><span class="k">            </span><span class="n">rj</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-193"></a>            <span class="n">qj</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-194"></a>            <span class="n">at_j</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-195"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">at_i</span> <span class="o">&lt;</span> <span class="n">at_j</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-196"></a><span class="k">                </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-197"></a>            <span class="k">else</span>
<a name="ln-198"></a><span class="k">                </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-199"></a>            <span class="k">end if</span>
<a name="ln-200"></a><span class="k">            </span><span class="n">rij</span> <span class="o">=</span> <span class="n">rj</span> <span class="o">-</span> <span class="n">ri</span>
<a name="ln-201"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-202"></a>            <span class="n">rij_mag</span> <span class="o">=</span> <span class="nb">norm2</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-203"></a>            <span class="k">call </span><span class="n">ia_get_vdw_force</span><span class="p">(</span><span class="n">rij_mag</span><span class="p">,</span> <span class="n">qi</span><span class="p">,</span> <span class="n">qj</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-204"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-205"></a><span class="k">            </span><span class="n">energy_vdw</span> <span class="o">=</span> <span class="n">energy_vdw</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-206"></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">frc</span><span class="o">*</span><span class="n">rij</span><span class="o">/</span><span class="n">rij_mag</span>
<a name="ln-207"></a>
<a name="ln-208"></a>            <span class="c">!Update forces</span>
<a name="ln-209"></a>            <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span>
<a name="ln-210"></a>            <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">fi</span>
<a name="ln-211"></a>
<a name="ln-212"></a>            <span class="c">!Update stress</span>
<a name="ln-213"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-214"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-215"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-216"></a>
<a name="ln-217"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-218"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-219"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-220"></a>
<a name="ln-221"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-222"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-223"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-224"></a>        <span class="k">end do</span>
<a name="ln-225"></a><span class="k">    end do</span>
<a name="ln-226"></a>
<a name="ln-227"></a><span class="k">    end subroutine</span>
<a name="ln-228"></a>
<a name="ln-229"></a><span class="c">!********************************************************************************</span>
<a name="ln-230"></a>
<a name="ln-231"></a><span class="k">subroutine </span><span class="n">ia_add_vdw_forces_vl</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-232"></a>    <span class="c">!! Calculates force and energy due to all short-ranged non-bonded pairwise</span>
<a name="ln-233"></a>    <span class="c">!! interactions and adds to `energy_vdw` &amp; &#39;forces` in module `m_globals`.</span>
<a name="ln-234"></a>    <span class="c">!! Uses Verlet table.</span>
<a name="ln-235"></a>
<a name="ln-236"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-237"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">nbrs</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-238"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ri</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">rij</span><span class="p">,</span> <span class="n">fi</span>
<a name="ln-239"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rij_mag</span>
<a name="ln-240"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qi</span><span class="p">,</span> <span class="n">qj</span>
<a name="ln-241"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span>
<a name="ln-242"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">at_i</span><span class="p">,</span> <span class="n">at_j</span><span class="p">,</span> <span class="n">typ</span>
<a name="ln-243"></a>
<a name="ln-244"></a>    <span class="n">ierr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-245"></a>
<a name="ln-246"></a>    <span class="k">call </span><span class="n">verlet_build</span><span class="p">()</span>
<a name="ln-247"></a>
<a name="ln-248"></a>    <span class="c">!call verlet_tab%print()</span>
<a name="ln-249"></a>
<a name="ln-250"></a>    <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="p">(</span><span class="n">num_atoms</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-251"></a>        <span class="n">ri</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-252"></a>        <span class="n">qi</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-253"></a>        <span class="n">at_i</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-254"></a>
<a name="ln-255"></a>        <span class="c">!Getting list of neighbors of particle i using pointer nbrs</span>
<a name="ln-256"></a>        <span class="k">call </span><span class="n">verlet_tab</span><span class="p">%</span><span class="n">get_row</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">nbrs</span><span class="p">)</span>
<a name="ln-257"></a>
<a name="ln-258"></a>        <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">nbrs</span><span class="p">)</span>
<a name="ln-259"></a>            <span class="n">j</span> <span class="o">=</span> <span class="n">nbrs</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-260"></a>            <span class="c">!Check if atom j is an excluded atom for atom i</span>
<a name="ln-261"></a>            <span class="k">if</span> <span class="p">(</span> <span class="n">exat_tab</span><span class="p">%</span><span class="n">is_in</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="p">)</span> <span class="k">cycle</span>
<a name="ln-262"></a>
<a name="ln-263"></a><span class="k">            </span><span class="n">rj</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-264"></a>            <span class="n">qj</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-265"></a>            <span class="n">at_j</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-266"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">at_i</span> <span class="o">&lt;</span> <span class="n">at_j</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-267"></a><span class="k">                </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-268"></a>            <span class="k">else</span>
<a name="ln-269"></a><span class="k">                </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-270"></a>            <span class="k">end if</span>
<a name="ln-271"></a><span class="k">            </span><span class="n">rij</span> <span class="o">=</span> <span class="n">rj</span> <span class="o">-</span> <span class="n">ri</span>
<a name="ln-272"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-273"></a>            <span class="n">rij_mag</span> <span class="o">=</span> <span class="nb">norm2</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-274"></a>            <span class="k">call </span><span class="n">ia_get_vdw_force</span><span class="p">(</span><span class="n">rij_mag</span><span class="p">,</span> <span class="n">qi</span><span class="p">,</span> <span class="n">qj</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-275"></a>            <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-276"></a>
<a name="ln-277"></a><span class="k">            </span><span class="n">energy_vdw</span> <span class="o">=</span> <span class="n">energy_vdw</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-278"></a>            <span class="n">fi</span> <span class="o">=</span> <span class="n">frc</span><span class="o">*</span><span class="n">rij</span><span class="o">/</span><span class="n">rij_mag</span>
<a name="ln-279"></a>            <span class="c">!Update forces</span>
<a name="ln-280"></a>            <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span>
<a name="ln-281"></a>            <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">fi</span>
<a name="ln-282"></a>
<a name="ln-283"></a>            <span class="c">!Update stress</span>
<a name="ln-284"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-285"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-286"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-287"></a>
<a name="ln-288"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-289"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-290"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-291"></a>
<a name="ln-292"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-293"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-294"></a>            <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-295"></a>        <span class="k">end do</span>
<a name="ln-296"></a><span class="k">    end do</span>
<a name="ln-297"></a>
<a name="ln-298"></a><span class="k">    end subroutine</span>
<a name="ln-299"></a>    
<a name="ln-300"></a><span class="c">!********************************************************************************</span>
<a name="ln-301"></a>
<a name="ln-302"></a><span class="k">subroutine </span><span class="n">ia_add_vdw_forces_cl</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-303"></a>    <span class="c">!! Calculates force and energy due to all short-ranged non-bonded pairwise</span>
<a name="ln-304"></a>    <span class="c">!! interactions and adds to `energy_vdw` &amp; &#39;forces` in module `m_globals`.</span>
<a name="ln-305"></a>    <span class="c">!! Uses cell list.</span>
<a name="ln-306"></a>
<a name="ln-307"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-308"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">aic</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-309"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">ainc</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-310"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">pointer</span> <span class="kd">::</span> <span class="n">nbr_cells</span> <span class="o">=&gt;</span> <span class="nb">null</span><span class="p">()</span>
<a name="ln-311"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ri</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">rij</span><span class="p">,</span> <span class="n">fi</span>
<a name="ln-312"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rij_mag</span>
<a name="ln-313"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qi</span><span class="p">,</span> <span class="n">qj</span>
<a name="ln-314"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span>
<a name="ln-315"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">num_cells</span>
<a name="ln-316"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">icell</span><span class="p">,</span> <span class="n">jcell</span><span class="p">,</span> <span class="n">iatm</span><span class="p">,</span> <span class="n">jatm</span>
<a name="ln-317"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">at_i</span><span class="p">,</span> <span class="n">at_j</span><span class="p">,</span> <span class="n">typ</span>
<a name="ln-318"></a>
<a name="ln-319"></a>    <span class="n">ierr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-320"></a>
<a name="ln-321"></a>    <span class="k">call </span><span class="n">cl_build</span><span class="p">(</span><span class="n">coordinates</span><span class="p">(:,</span><span class="mi">1</span><span class="p">:</span><span class="n">num_atoms</span><span class="p">))</span>
<a name="ln-322"></a>    <span class="n">num_cells</span> <span class="o">=</span> <span class="n">cl_get_num_cells</span><span class="p">()</span>
<a name="ln-323"></a>
<a name="ln-324"></a>    <span class="k">do </span><span class="n">icell</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">num_cells</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-325"></a>        <span class="k">call </span><span class="n">cl_get_contents</span><span class="p">(</span><span class="n">icell</span><span class="p">,</span> <span class="n">aic</span><span class="p">)</span>
<a name="ln-326"></a>        <span class="k">call </span><span class="n">cl_get_nbr_cells</span><span class="p">(</span><span class="n">icell</span><span class="p">,</span> <span class="n">nbr_cells</span><span class="p">)</span>
<a name="ln-327"></a>
<a name="ln-328"></a>        <span class="c">!Interaction with particles within the cell</span>
<a name="ln-329"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">aic</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
<a name="ln-330"></a>            <span class="n">iatm</span> <span class="o">=</span> <span class="n">aic</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-331"></a>            <span class="n">ri</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">iatm</span><span class="p">)</span>
<a name="ln-332"></a>            <span class="n">qi</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">iatm</span><span class="p">)</span>
<a name="ln-333"></a>            <span class="n">at_i</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">iatm</span><span class="p">)</span>
<a name="ln-334"></a>
<a name="ln-335"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">aic</span><span class="p">)</span>
<a name="ln-336"></a>                <span class="n">jatm</span> <span class="o">=</span> <span class="n">aic</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-337"></a>                <span class="c">!Check if atom jatm is an excluded atom for atom iatm</span>
<a name="ln-338"></a>                <span class="k">if</span> <span class="p">(</span> <span class="n">exat_tab</span><span class="p">%</span><span class="n">is_in</span><span class="p">(</span><span class="n">iatm</span><span class="p">,</span><span class="n">jatm</span><span class="p">)</span> <span class="p">)</span> <span class="k">cycle</span>
<a name="ln-339"></a>
<a name="ln-340"></a><span class="k">                </span><span class="n">rj</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">jatm</span><span class="p">)</span>
<a name="ln-341"></a>                <span class="n">qj</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">jatm</span><span class="p">)</span>
<a name="ln-342"></a>                <span class="n">at_j</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">jatm</span><span class="p">)</span>
<a name="ln-343"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">at_i</span> <span class="o">&lt;</span> <span class="n">at_j</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-344"></a><span class="k">                    </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-345"></a>                <span class="k">else</span>
<a name="ln-346"></a><span class="k">                    </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-347"></a>                <span class="k">end if</span>
<a name="ln-348"></a><span class="k">                </span><span class="n">rij</span> <span class="o">=</span> <span class="n">rj</span> <span class="o">-</span> <span class="n">ri</span>
<a name="ln-349"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-350"></a>                <span class="n">rij_mag</span> <span class="o">=</span> <span class="nb">norm2</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-351"></a>                <span class="k">call </span><span class="n">ia_get_vdw_force</span><span class="p">(</span><span class="n">rij_mag</span><span class="p">,</span> <span class="n">qi</span><span class="p">,</span> <span class="n">qj</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-352"></a>                <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-353"></a>
<a name="ln-354"></a><span class="k">                </span><span class="n">energy_vdw</span> <span class="o">=</span> <span class="n">energy_vdw</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-355"></a>                <span class="n">fi</span> <span class="o">=</span> <span class="n">frc</span><span class="o">*</span><span class="n">rij</span><span class="o">/</span><span class="n">rij_mag</span>
<a name="ln-356"></a>
<a name="ln-357"></a>                <span class="c">!Update forces</span>
<a name="ln-358"></a>                <span class="n">forces</span><span class="p">(:,</span><span class="n">iatm</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">iatm</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span>
<a name="ln-359"></a>                <span class="n">forces</span><span class="p">(:,</span><span class="n">jatm</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">jatm</span><span class="p">)</span> <span class="o">-</span> <span class="n">fi</span>
<a name="ln-360"></a>
<a name="ln-361"></a>                <span class="c">!Update stress</span>
<a name="ln-362"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-363"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-364"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-365"></a>
<a name="ln-366"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-367"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-368"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-369"></a>
<a name="ln-370"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-371"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-372"></a>                <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-373"></a>            <span class="k">end do</span>
<a name="ln-374"></a><span class="k">        end do</span>
<a name="ln-375"></a>
<a name="ln-376"></a>        <span class="c">!Interaction with particles belonging to neighboring cells</span>
<a name="ln-377"></a>        <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">aic</span><span class="p">)</span>
<a name="ln-378"></a>            <span class="n">iatm</span> <span class="o">=</span> <span class="n">aic</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-379"></a>            <span class="n">ri</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">iatm</span><span class="p">)</span>
<a name="ln-380"></a>            <span class="n">qi</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">iatm</span><span class="p">)</span>
<a name="ln-381"></a>            <span class="n">at_i</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">iatm</span><span class="p">)</span>
<a name="ln-382"></a>
<a name="ln-383"></a>            <span class="k">do </span><span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">nbr_cells</span><span class="p">)</span>
<a name="ln-384"></a>                <span class="n">jcell</span> <span class="o">=</span> <span class="n">nbr_cells</span><span class="p">(</span><span class="n">j</span><span class="p">)</span>
<a name="ln-385"></a>                <span class="k">call </span><span class="n">cl_get_contents</span><span class="p">(</span><span class="n">jcell</span><span class="p">,</span> <span class="n">ainc</span><span class="p">)</span>
<a name="ln-386"></a>
<a name="ln-387"></a>                <span class="k">do </span><span class="n">k</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">size</span><span class="p">(</span><span class="n">ainc</span><span class="p">)</span>
<a name="ln-388"></a>                    <span class="n">jatm</span> <span class="o">=</span> <span class="n">ainc</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>
<a name="ln-389"></a>                    <span class="c">!Check if atom jatm is an excluded atom for atom iatm</span>
<a name="ln-390"></a>                    <span class="k">if</span> <span class="p">(</span> <span class="n">exat_tab</span><span class="p">%</span><span class="n">is_in</span><span class="p">(</span><span class="n">iatm</span><span class="p">,</span><span class="n">jatm</span><span class="p">)</span> <span class="p">)</span> <span class="k">cycle</span>
<a name="ln-391"></a>
<a name="ln-392"></a><span class="k">                    </span><span class="n">rj</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">jatm</span><span class="p">)</span>
<a name="ln-393"></a>                    <span class="n">qj</span> <span class="o">=</span> <span class="n">charge</span><span class="p">(</span><span class="n">jatm</span><span class="p">)</span>
<a name="ln-394"></a>                    <span class="n">at_j</span> <span class="o">=</span> <span class="n">atoms</span><span class="p">(</span><span class="n">jatm</span><span class="p">)</span>
<a name="ln-395"></a>
<a name="ln-396"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">at_i</span> <span class="o">&lt;</span> <span class="n">at_j</span><span class="p">)</span> <span class="k">then</span>
<a name="ln-397"></a><span class="k">                        </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_j</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_i</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-398"></a>                    <span class="k">else</span>
<a name="ln-399"></a><span class="k">                        </span><span class="n">typ</span> <span class="o">=</span> <span class="n">at_i</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">num_atom_types</span><span class="o">-</span><span class="n">at_j</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">at_j</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span>
<a name="ln-400"></a>                    <span class="k">end if</span>
<a name="ln-401"></a><span class="k">                    </span><span class="n">rij</span> <span class="o">=</span> <span class="n">rj</span> <span class="o">-</span> <span class="n">ri</span>
<a name="ln-402"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-403"></a>                    <span class="n">rij_mag</span> <span class="o">=</span> <span class="nb">norm2</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-404"></a>                    <span class="k">call </span><span class="n">ia_get_vdw_force</span><span class="p">(</span><span class="n">rij_mag</span><span class="p">,</span> <span class="n">qi</span><span class="p">,</span> <span class="n">qj</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-405"></a>                    <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-406"></a>
<a name="ln-407"></a><span class="k">                    </span><span class="n">energy_vdw</span> <span class="o">=</span> <span class="n">energy_vdw</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-408"></a>                    <span class="n">fi</span> <span class="o">=</span> <span class="n">frc</span><span class="o">*</span><span class="n">rij</span><span class="o">/</span><span class="n">rij_mag</span>
<a name="ln-409"></a>
<a name="ln-410"></a>                    <span class="c">!Update forces</span>
<a name="ln-411"></a>                    <span class="n">forces</span><span class="p">(:,</span><span class="n">iatm</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">iatm</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span>
<a name="ln-412"></a>                    <span class="n">forces</span><span class="p">(:,</span><span class="n">jatm</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">jatm</span><span class="p">)</span> <span class="o">-</span> <span class="n">fi</span>
<a name="ln-413"></a>                    
<a name="ln-414"></a>                    <span class="c">!Update stress</span>
<a name="ln-415"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-416"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-417"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-418"></a>
<a name="ln-419"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-420"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-421"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-422"></a>
<a name="ln-423"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-424"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-425"></a>                    <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-426"></a>                <span class="k">end do</span>
<a name="ln-427"></a>
<a name="ln-428"></a><span class="k">            end do</span>
<a name="ln-429"></a>
<a name="ln-430"></a><span class="k">        end do</span>
<a name="ln-431"></a>
<a name="ln-432"></a><span class="k">    end do</span>
<a name="ln-433"></a>
<a name="ln-434"></a><span class="k">    end subroutine</span>
<a name="ln-435"></a>
<a name="ln-436"></a><span class="c">!*******************************************************************************</span>
<a name="ln-437"></a>
<a name="ln-438"></a><span class="k">subroutine </span><span class="n">ia_add_bond_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-439"></a>    <span class="c">!! Calculates forces &amp; energy due to all bonds. Will add to </span>
<a name="ln-440"></a>    <span class="c">!! `energy_bond` &amp; and &#39;forces` in module `m_globals`.</span>
<a name="ln-441"></a>
<a name="ln-442"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-443"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ri</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">rij</span><span class="p">,</span> <span class="n">fi</span>
<a name="ln-444"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rij_mag</span>
<a name="ln-445"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span>
<a name="ln-446"></a>    <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">ibnd</span><span class="p">,</span> <span class="n">typ</span>
<a name="ln-447"></a>    <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span>
<a name="ln-448"></a>
<a name="ln-449"></a>    <span class="n">ierr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-450"></a>
<a name="ln-451"></a>    <span class="k">do </span><span class="n">ibnd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_bonds</span>
<a name="ln-452"></a>        <span class="n">typ</span> <span class="o">=</span> <span class="n">bonds</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">ibnd</span><span class="p">)</span>
<a name="ln-453"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">bonds</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">ibnd</span><span class="p">)</span>
<a name="ln-454"></a>        <span class="n">j</span> <span class="o">=</span> <span class="n">bonds</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">ibnd</span><span class="p">)</span>
<a name="ln-455"></a>        <span class="n">ri</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-456"></a>        <span class="n">rj</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-457"></a>        <span class="n">rij</span> <span class="o">=</span> <span class="n">rj</span> <span class="o">-</span> <span class="n">ri</span>
<a name="ln-458"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-459"></a>        <span class="n">rij_mag</span> <span class="o">=</span> <span class="nb">norm2</span><span class="p">(</span><span class="n">rij</span><span class="p">)</span>
<a name="ln-460"></a>
<a name="ln-461"></a>        <span class="n">bndlen</span> <span class="o">=</span> <span class="n">bndlen</span> <span class="o">+</span> <span class="n">rij_mag</span>
<a name="ln-462"></a>        <span class="n">bndlen_min</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bndlen_min</span><span class="p">,</span> <span class="n">rij_mag</span><span class="p">)</span>
<a name="ln-463"></a>        <span class="n">bndlen_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">bndlen_max</span><span class="p">,</span> <span class="n">rij_mag</span><span class="p">)</span>
<a name="ln-464"></a>
<a name="ln-465"></a>        <span class="k">call </span><span class="n">ia_get_bond_force</span><span class="p">(</span><span class="n">rij_mag</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-466"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-467"></a><span class="k">        </span><span class="n">energy_bond</span> <span class="o">=</span> <span class="n">energy_bond</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-468"></a>        <span class="n">fi</span> <span class="o">=</span> <span class="n">frc</span><span class="o">*</span><span class="n">rij</span><span class="o">/</span><span class="n">rij_mag</span>
<a name="ln-469"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span>
<a name="ln-470"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">-</span> <span class="n">fi</span>
<a name="ln-471"></a>
<a name="ln-472"></a>        <span class="c">!Update stress</span>
<a name="ln-473"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-474"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-475"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-476"></a>
<a name="ln-477"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-478"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-479"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-480"></a>
<a name="ln-481"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-482"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-483"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">rij</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fi</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-484"></a>    <span class="k">end do</span>
<a name="ln-485"></a>
<a name="ln-486"></a><span class="k">    </span><span class="n">bndlen</span> <span class="o">=</span> <span class="n">bndlen</span><span class="o">/</span><span class="n">num_bonds</span>
<a name="ln-487"></a>
<a name="ln-488"></a>    <span class="k">end subroutine</span>
<a name="ln-489"></a>    
<a name="ln-490"></a><span class="c">!********************************************************************************</span>
<a name="ln-491"></a>
<a name="ln-492"></a><span class="k">subroutine </span><span class="n">ia_add_angle_forces</span><span class="p">()</span>
<a name="ln-493"></a>    <span class="c">!! Calculates forces &amp; energy due to all angles. Will add to </span>
<a name="ln-494"></a>    <span class="c">!! `energy_angle` &amp; &#39;forces` in module `m_globals`.</span>
<a name="ln-495"></a>     
<a name="ln-496"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">rim1</span><span class="p">,</span> <span class="n">ri</span><span class="p">,</span> <span class="n">rip1</span><span class="p">,</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span>
<a name="ln-497"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fim1</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">fip1</span>
<a name="ln-498"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">enrg</span>
<a name="ln-499"></a>    <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">iang</span>
<a name="ln-500"></a>    <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">typ</span>
<a name="ln-501"></a>    <span class="kt">integer</span>  <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">im1</span><span class="p">,</span> <span class="n">ip1</span>
<a name="ln-502"></a>
<a name="ln-503"></a>    <span class="k">do </span><span class="n">iang</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_angles</span>
<a name="ln-504"></a>        <span class="n">typ</span> <span class="o">=</span> <span class="n">angles</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">iang</span><span class="p">)</span>
<a name="ln-505"></a>        <span class="n">im1</span> <span class="o">=</span> <span class="n">angles</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">iang</span><span class="p">)</span>
<a name="ln-506"></a>        <span class="n">i</span>   <span class="o">=</span> <span class="n">angles</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">iang</span><span class="p">)</span>
<a name="ln-507"></a>        <span class="n">ip1</span> <span class="o">=</span> <span class="n">angles</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="n">iang</span><span class="p">)</span>
<a name="ln-508"></a>
<a name="ln-509"></a>        <span class="n">rim1</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">im1</span><span class="p">)</span>
<a name="ln-510"></a>        <span class="n">ri</span>   <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-511"></a>        <span class="n">rip1</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">ip1</span><span class="p">)</span>
<a name="ln-512"></a>        <span class="n">q1</span> <span class="o">=</span> <span class="n">ri</span> <span class="o">-</span> <span class="n">rim1</span><span class="p">;</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">rip1</span> <span class="o">-</span> <span class="n">ri</span>
<a name="ln-513"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
<a name="ln-514"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
<a name="ln-515"></a>
<a name="ln-516"></a>        <span class="k">call </span><span class="n">ia_get_angle_force</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">fim1</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">fip1</span><span class="p">)</span>
<a name="ln-517"></a>        <span class="n">energy_angle</span> <span class="o">=</span> <span class="n">energy_angle</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-518"></a>
<a name="ln-519"></a>        <span class="c">!Update forces</span>
<a name="ln-520"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">im1</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">im1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fim1</span>
<a name="ln-521"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span>   <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span>   <span class="o">+</span> <span class="n">fi</span>
<a name="ln-522"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">ip1</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">ip1</span><span class="p">)</span> <span class="o">+</span> <span class="n">fip1</span>
<a name="ln-523"></a>
<a name="ln-524"></a>        <span class="c">!Update stress</span>
<a name="ln-525"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-526"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-527"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-528"></a>
<a name="ln-529"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-530"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-531"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-532"></a>
<a name="ln-533"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-534"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-535"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="n">q1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fim1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">q2</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fip1</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-536"></a>    <span class="k">end do</span>
<a name="ln-537"></a>
<a name="ln-538"></a><span class="k">    end subroutine</span>
<a name="ln-539"></a>    
<a name="ln-540"></a><span class="c">!********************************************************************************</span>
<a name="ln-541"></a>
<a name="ln-542"></a><span class="k">subroutine </span><span class="n">ia_add_dihedral_forces</span><span class="p">()</span>
<a name="ln-543"></a>    <span class="c">!! Calculates forces &amp; energy due to all dihedrals. Will add to </span>
<a name="ln-544"></a>    <span class="c">!! `energy_dihedral` &amp; &#39;forces` in module `m_globals`.</span>
<a name="ln-545"></a>
<a name="ln-546"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ri</span><span class="p">,</span> <span class="n">rj</span><span class="p">,</span> <span class="n">rk</span><span class="p">,</span> <span class="n">rl</span>
<a name="ln-547"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span>
<a name="ln-548"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">fi</span><span class="p">,</span> <span class="n">fj</span><span class="p">,</span> <span class="n">fk</span><span class="p">,</span> <span class="n">fl</span>
<a name="ln-549"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">enrg</span>
<a name="ln-550"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">idhd</span>
<a name="ln-551"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">typ</span>
<a name="ln-552"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">l</span>
<a name="ln-553"></a>
<a name="ln-554"></a>    <span class="k">do </span><span class="n">idhd</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_dihedrals</span>
<a name="ln-555"></a>        <span class="n">typ</span> <span class="o">=</span> <span class="n">dihedrals</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">idhd</span><span class="p">)</span>
<a name="ln-556"></a>        <span class="n">i</span> <span class="o">=</span> <span class="n">dihedrals</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="n">idhd</span><span class="p">)</span>
<a name="ln-557"></a>        <span class="n">j</span> <span class="o">=</span> <span class="n">dihedrals</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">idhd</span><span class="p">)</span>
<a name="ln-558"></a>        <span class="n">k</span> <span class="o">=</span> <span class="n">dihedrals</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">idhd</span><span class="p">)</span>
<a name="ln-559"></a>        <span class="n">l</span> <span class="o">=</span> <span class="n">dihedrals</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">idhd</span><span class="p">)</span>
<a name="ln-560"></a>
<a name="ln-561"></a>        <span class="n">ri</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span>
<a name="ln-562"></a>        <span class="n">rj</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span>
<a name="ln-563"></a>        <span class="n">rk</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">k</span><span class="p">)</span>
<a name="ln-564"></a>        <span class="n">rl</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">l</span><span class="p">)</span>
<a name="ln-565"></a>
<a name="ln-566"></a>        <span class="n">q1</span> <span class="o">=</span> <span class="n">rj</span> <span class="o">-</span> <span class="n">ri</span><span class="p">;</span> <span class="n">q2</span> <span class="o">=</span> <span class="n">rk</span> <span class="o">-</span> <span class="n">rj</span><span class="p">;</span> <span class="n">q3</span> <span class="o">=</span> <span class="n">rl</span> <span class="o">-</span> <span class="n">rk</span>
<a name="ln-567"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
<a name="ln-568"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
<a name="ln-569"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">imcon</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">call </span><span class="n">simbox</span><span class="p">%</span><span class="n">get_image</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span>
<a name="ln-570"></a>
<a name="ln-571"></a>        <span class="k">call </span><span class="n">ia_get_dihedral_force</span><span class="p">(</span><span class="n">q1</span><span class="p">,</span> <span class="n">q2</span><span class="p">,</span> <span class="n">q3</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">fj</span><span class="p">,</span> <span class="n">fk</span><span class="p">,</span> <span class="n">fl</span><span class="p">)</span>
<a name="ln-572"></a>        <span class="n">energy_dihedral</span> <span class="o">=</span> <span class="n">energy_dihedral</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-573"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">i</span><span class="p">)</span> <span class="o">+</span> <span class="n">fi</span>
<a name="ln-574"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">j</span><span class="p">)</span> <span class="o">+</span> <span class="n">fj</span>
<a name="ln-575"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">k</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">k</span><span class="p">)</span> <span class="o">+</span> <span class="n">fk</span>
<a name="ln-576"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">l</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">l</span><span class="p">)</span> <span class="o">+</span> <span class="n">fl</span>
<a name="ln-577"></a>
<a name="ln-578"></a>        <span class="c">!TODO: Add the contribution to stress here. </span>
<a name="ln-579"></a>    <span class="k">end do</span>
<a name="ln-580"></a>
<a name="ln-581"></a><span class="k">    end subroutine</span>
<a name="ln-582"></a>    
<a name="ln-583"></a><span class="c">!********************************************************************************</span>
<a name="ln-584"></a>
<a name="ln-585"></a><span class="k">subroutine </span><span class="n">ia_add_tether_forces</span><span class="p">(</span><span class="n">ierr</span><span class="p">)</span>
<a name="ln-586"></a>    <span class="c">!! Calculates forces &amp; energy due to all tethers. Will add to `energy_tether` &amp;</span>
<a name="ln-587"></a>    <span class="c">!! &#39;forces` in module `m_globals`. Tether forces cannot be subject to</span>
<a name="ln-588"></a>    <span class="c">!! periodic boundary conditions.</span>
<a name="ln-589"></a>
<a name="ln-590"></a>    <span class="kt">integer</span><span class="p">,</span> <span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span> <span class="kd">::</span> <span class="n">ierr</span>
<a name="ln-591"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="kd">::</span> <span class="n">r</span><span class="p">,</span> <span class="n">tp</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">fj</span>
<a name="ln-592"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">qmag</span>
<a name="ln-593"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">rp</span><span class="p">)</span> <span class="kd">::</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span>
<a name="ln-594"></a>    <span class="kt">integer</span> <span class="kd">::</span> <span class="n">iteth</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">teth_iatm</span>
<a name="ln-595"></a>
<a name="ln-596"></a>    <span class="n">ierr</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-597"></a>
<a name="ln-598"></a>    <span class="k">do </span><span class="n">iteth</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">num_tethers</span>
<a name="ln-599"></a>        <span class="n">typ</span> <span class="o">=</span> <span class="n">tethers</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="n">iteth</span><span class="p">)</span>
<a name="ln-600"></a>        <span class="n">teth_iatm</span> <span class="o">=</span> <span class="n">tethers</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="n">iteth</span><span class="p">)</span> <span class="c">!Index of the tethered atom</span>
<a name="ln-601"></a>        <span class="n">tp</span> <span class="o">=</span> <span class="n">tether_points</span><span class="p">(:,</span><span class="n">iteth</span><span class="p">)</span>
<a name="ln-602"></a>        <span class="n">r</span> <span class="o">=</span> <span class="n">coordinates</span><span class="p">(:,</span><span class="n">teth_iatm</span><span class="p">)</span>
<a name="ln-603"></a>        <span class="n">q</span> <span class="o">=</span> <span class="n">r</span> <span class="o">-</span> <span class="n">tp</span>
<a name="ln-604"></a>        <span class="n">qmag</span> <span class="o">=</span> <span class="nb">norm2</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
<a name="ln-605"></a>        <span class="k">call </span><span class="n">ia_get_tether_force</span><span class="p">(</span><span class="n">qmag</span><span class="p">,</span> <span class="n">typ</span><span class="p">,</span> <span class="n">enrg</span><span class="p">,</span> <span class="n">frc</span><span class="p">,</span> <span class="n">ierr</span><span class="p">)</span>
<a name="ln-606"></a>        <span class="k">if</span> <span class="p">(</span><span class="n">ierr</span> <span class="o">/=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span>
<a name="ln-607"></a>
<a name="ln-608"></a><span class="k">        </span><span class="n">fj</span> <span class="o">=</span> <span class="o">-</span><span class="n">frc</span><span class="o">*</span><span class="n">q</span><span class="o">/</span><span class="n">qmag</span>
<a name="ln-609"></a>        <span class="n">energy_tether</span> <span class="o">=</span> <span class="n">energy_tether</span> <span class="o">+</span> <span class="n">enrg</span>
<a name="ln-610"></a>        <span class="n">forces</span><span class="p">(:,</span><span class="n">teth_iatm</span><span class="p">)</span> <span class="o">=</span> <span class="n">forces</span><span class="p">(:,</span><span class="n">teth_iatm</span><span class="p">)</span> <span class="o">+</span> <span class="n">fj</span>
<a name="ln-611"></a>
<a name="ln-612"></a>        <span class="c">!Update stress</span>
<a name="ln-613"></a>        <span class="c">!Sign flipped since fj, not fi is involved</span>
<a name="ln-614"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-615"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-616"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-617"></a>
<a name="ln-618"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-619"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-620"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-621"></a>
<a name="ln-622"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-623"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-624"></a>        <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">=</span> <span class="n">stress</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">q</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span><span class="o">*</span><span class="n">fj</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<a name="ln-625"></a>    <span class="k">end do</span>
<a name="ln-626"></a>
<a name="ln-627"></a><span class="k">    end subroutine</span>
<a name="ln-628"></a>    
<a name="ln-629"></a><span class="c">!******************************************************************************</span>
<a name="ln-630"></a>
<a name="ln-631"></a><span class="k">end module </span><span class="n">m_interaction</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2019 <a rel="license" href="http://www.freebsd.org/copyright/freebsd-doc-license.html">FreeBSD Documentation License</a>
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
            
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> BROWNPAK was developed by Sarit Dutta</p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>